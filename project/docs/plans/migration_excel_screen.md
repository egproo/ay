# شاشة الانتقال من ملفات Excel (Migration from Excel Files)

## معلومات الشاشة
- **المسار**: `migration/excel`
- **الترتيب**: الشاشة رقم 43 في العمود الجانبي (ضمن قسم الانتقال من الأنظمة الأخرى)
- **الأولوية**: عالية جداً - أداة مهمة لاستيراد البيانات من ملفات Excel

## الحالة الحالية
✅ **مكتمل بالكامل** - تم إنشاء جميع المكونات المطلوبة

### المكونات المكتملة:
1. ✅ **Controller**: `dashboard/controller/migration/excel.php` (كان موجود ومتطور)
2. ✅ **Model**: `dashboard/model/migration/excel.php` (تم إنشاؤه)
3. ✅ **View**: `dashboard/view/template/migration/excel.twig` (كان موجود ومتطور)
4. ✅ **Language**: `dashboard/language/ar/migration/excel.php` (تم إنشاؤه)
5. ✅ **Database**: جداول قاعدة البيانات موجودة في النظام

## الوظائف الرئيسية

### 1. رفع ملفات Excel
- دعم تنسيقات .xlsx و .xls
- التحقق من صحة الملف وحجمه
- قراءة أوراق العمل المتعددة
- معاينة محتوى الملف قبل الاستيراد

### 2. ربط أوراق العمل
#### البيانات الأساسية:
- **المنتجات**: استيراد بيانات المنتجات الكاملة
- **العملاء**: بيانات العملاء وعناوينهم
- **الطلبات**: الطلبات وتفاصيلها

#### البيانات الإضافية:
- **فئات المنتجات**: التصنيف الهرمي
- **الموردين**: بيانات الموردين
- **المخزون**: كميات وحركات المخزون

### 3. معالجة البيانات المتقدمة
- **ربط الحقول التلقائي**: مطابقة أعمدة Excel مع حقول النظام
- **التحقق من صحة البيانات**: فحص البيانات قبل الاستيراد
- **معالجة البيانات المكررة**: كشف ومعالجة التكرار
- **تحويل تنسيقات البيانات**: تحويل التواريخ والأرقام

### 4. خيارات الاستيراد المتقدمة
- **الاستيراد الكامل**: جميع البيانات دفعة واحدة
- **الاستيراد التدريجي**: على دفعات صغيرة
- **تحديث الموجود**: تحديث البيانات الموجودة
- **إدراج الجديد فقط**: تجاهل البيانات الموجودة

### 5. التحقق من صحة البيانات
- فحص الحقول المطلوبة
- التحقق من تنسيقات البيانات
- كشف التضارب والتكرار
- التحقق من العلاقات والتبعيات

### 6. معالجة الأخطاء المتقدمة
- تسجيل مفصل للأخطاء
- إمكانية المتابعة عند حدوث أخطاء
- إعادة المحاولة للعمليات الفاشلة
- تقارير مفصلة للمراجعة

## الجداول المرتبطة

### 1. جداول النقل والمراجعة
```sql
- cod_migration: سجل عمليات الاستيراد
  - migration_id (PK)
  - source (varchar) = 'excel'
  - file_name (varchar)
  - total_records (int)
  - status (enum: pending, processing, completed, failed)
  - date_added (datetime)
  - date_completed (datetime)

- cod_migration_log: سجل تفصيلي للعمليات
  - log_id (PK)
  - migration_id (FK)
  - operation_type (varchar)
  - message (text)
  - level (enum: info, warning, error)
  - date_added (datetime)

- cod_migration_mapping: ربط الحقول
  - mapping_id (PK)
  - migration_id (FK)
  - source_field (varchar)
  - target_field (varchar)
  - transformation_rule (text)
```

### 2. جداول البيانات المؤقتة
```sql
- cod_migration_temp_excel_products: منتجات مؤقتة
  - migration_temp_id (PK)
  - migration_id (FK)
  - sheet_name (varchar)
  - source_data (json)
  - status (enum: pending, completed, error)
  - error_message (text)
  - date_added (datetime)
  - processed_at (datetime)

- cod_migration_temp_excel_customers: عملاء مؤقتون
  - migration_temp_id (PK)
  - migration_id (FK)
  - sheet_name (varchar)
  - source_data (json)
  - status (enum: pending, completed, error)
  - error_message (text)
  - date_added (datetime)
  - processed_at (datetime)

- cod_migration_temp_excel_orders: طلبات مؤقتة
- cod_migration_temp_excel_categories: فئات مؤقتة
- cod_migration_temp_excel_suppliers: موردين مؤقتون
- cod_migration_temp_excel_inventory: مخزون مؤقت
```

### 3. جداول البيانات المستهدفة
```sql
- cod_product: المنتجات المستوردة
- cod_product_description: أوصاف المنتجات
- cod_customer: العملاء المستوردون
- cod_address: عناوين العملاء
- cod_order: الطلبات المستوردة
- cod_order_product: منتجات الطلبات
- cod_category: فئات المنتجات
- cod_supplier: الموردين
- cod_inventory_movement: حركات المخزون
```

## خطوات عملية الاستيراد

### 1. المرحلة الأولى: رفع الملف
1. اختيار ملف Excel من الجهاز
2. التحقق من نوع وحجم الملف
3. قراءة أوراق العمل المتاحة
4. عرض معاينة للبيانات

### 2. المرحلة الثانية: ربط أوراق العمل
1. عرض قائمة أوراق العمل المتاحة
2. ربط كل ورقة بنوع بيانات محدد
3. تحديد صف العناوين
4. اختيار نطاق البيانات

### 3. المرحلة الثالثة: ربط الحقول
1. عرض أعمدة كل ورقة عمل
2. ربط تلقائي للحقول المتشابهة
3. إمكانية الربط اليدوي
4. تحديد قواعد التحويل

### 4. المرحلة الرابعة: التحقق والمراجعة
1. فحص صحة البيانات
2. كشف البيانات المكررة
3. التحقق من الحقول المطلوبة
4. عرض تقرير التحقق

### 5. المرحلة الخامسة: التطبيق النهائي
1. معالجة البيانات على دفعات
2. إدراج البيانات في الجداول النهائية
3. إنشاء العلاقات والروابط
4. تحديث الإحصائيات

## الميزات التقنية المتقدمة

### 1. PhpSpreadsheet Integration
- استخدام مكتبة PhpSpreadsheet لقراءة Excel
- دعم جميع تنسيقات Excel الحديثة
- قراءة البيانات فقط لتحسين الأداء
- معالجة الملفات الكبيرة بكفاءة

### 2. معالجة البيانات الذكية
- كشف تلقائي لأنواع البيانات
- تحويل تنسيقات التاريخ والوقت
- معالجة الأرقام والعملات
- تنظيف النصوص والمسافات

### 3. الأمان والحماية
- التحقق من أنواع الملفات المسموحة
- فحص الملفات من الفيروسات
- تشفير البيانات المؤقتة
- تسجيل جميع العمليات

### 4. واجهة المستخدم المحسنة
- معالج خطوة بخطوة
- شريط تقدم تفاعلي
- معاينة مباشرة للبيانات
- رسائل خطأ واضحة

## قوالب Excel المدعومة

### 1. قالب المنتجات
```
الأعمدة المطلوبة:
- اسم المنتج (name) *مطلوب
- موديل المنتج (model) *مطلوب
- رمز المنتج (sku)
- السعر (price)
- الكمية (quantity)
- الوصف (description)
- الحالة (status)
- الوزن (weight)
- الأبعاد (length, width, height)
```

### 2. قالب العملاء
```
الأعمدة المطلوبة:
- الاسم الأول (firstname) *مطلوب
- الاسم الأخير (lastname)
- البريد الإلكتروني (email) *مطلوب
- رقم الهاتف (telephone)
- العنوان (address_1)
- المدينة (city)
- الرمز البريدي (postcode)
```

### 3. قالب الطلبات
```
الأعمدة المطلوبة:
- رقم الطلب (order_id)
- بريد العميل (customer_email) *مطلوب
- تاريخ الطلب (date_added)
- إجمالي الطلب (total)
- حالة الطلب (order_status)
- منتجات الطلب (products) - JSON أو منفصلة
```

## التقارير والسجلات

### 1. تقرير الاستيراد
- عدد السجلات المعالجة لكل نوع
- السجلات الناجحة والفاشلة
- الوقت المستغرق لكل مرحلة
- حجم البيانات المستوردة

### 2. سجل العمليات
- تسجيل تفصيلي لكل عملية
- رسائل الخطأ والتحذيرات
- إحصائيات الأداء
- معلومات التشخيص

### 3. تقرير المراجعة
- مقارنة البيانات قبل وبعد الاستيراد
- كشف الاختلافات والتغييرات
- تحليل جودة البيانات
- توصيات للتحسين

## التكامل مع النظام

### 1. ربط محاسبي
- إنشاء قيود للمنتجات الجديدة
- تحديث أرصدة المخزون
- ربط العملاء بالحسابات
- معالجة الضرائب والخصومات

### 2. تكامل المخزون
- تحديث كميات المنتجات
- إنشاء حركات جرد
- ربط المنتجات بالمواقع
- تحديث تكاليف المنتجات

### 3. تكامل التجارة الإلكترونية
- ربط المنتجات بالمتجر الإلكتروني
- تحديث أسعار البيع
- معالجة الصور والأوصاف
- إعداد خيارات الشحن

## ما بعد الاستيراد

### 1. التحقق من النتائج
- مراجعة البيانات المستوردة
- اختبار وظائف النظام
- التأكد من صحة التقارير
- مقارنة الأرصدة والإجماليات

### 2. التحسين والضبط
- تحسين أداء النظام
- ضبط الإعدادات حسب الحاجة
- إضافة تخصيصات إضافية
- تحديث البيانات المرجعية

### 3. التدريب والدعم
- تدريب المستخدمين على النظام
- دليل استخدام قوالب Excel
- دعم فني متخصص
- حل المشاكل والاستفسارات

## الفوائد التنافسية

### 1. سهولة الاستيراد
- واجهة بسيطة وواضحة
- دعم قوالب جاهزة
- معالج خطوة بخطوة
- تقليل الأخطاء البشرية

### 2. مرونة عالية
- دعم أنواع بيانات متعددة
- خيارات ربط متقدمة
- معالجة ملفات معقدة
- تخصيص قواعد التحويل

### 3. جودة البيانات
- التحقق من صحة البيانات
- تنظيف وتحسين البيانات
- إزالة التكرار
- ضمان تكامل البيانات

## خطة التطوير المستقبلية

### 1. المرحلة الثانية
- دعم تنسيقات ملفات إضافية (CSV, XML)
- استيراد الصور والمرفقات
- معالجة متوازية للملفات الكبيرة
- تحسينات الأداء

### 2. المرحلة الثالثة
- استيراد مجدول تلقائي
- تكامل مع خدمات التخزين السحابي
- ذكاء اصطناعي لتحسين ربط الحقول
- تحليل ذكي للبيانات

### 3. التحسينات المستمرة
- تحسين واجهة المستخدم
- إضافة قوالب جديدة
- تحسين معالجة الأخطاء
- تطوير أدوات المراجعة

## الخلاصة
شاشة الانتقال من ملفات Excel تعتبر أداة أساسية ومهمة في نظام أيم ERP، حيث تتيح للمستخدمين استيراد البيانات بسهولة ومرونة من ملفات Excel المختلفة. تم تصميمها لتكون شاملة وموثوقة، مع دعم كامل لجميع أنواع البيانات والتحقق من صحتها، مما يضمن استيراد ناجح وسلس للبيانات مع الحفاظ على جودتها وتكاملها.
