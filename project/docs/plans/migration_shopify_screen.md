# شاشة الانتقال من نظام شوبيفاي (Migration from Shopify)

## معلومات الشاشة
- **المسار**: `migration/shopify`
- **الترتيب**: الشاشة رقم 42 في العمود الجانبي (ضمن قسم الانتقال من الأنظمة الأخرى)
- **الأولوية**: عالية جداً - ضرورية لجذب عملاء شوبيفاي للانتقال إلى نظام أيم

## الحالة الحالية
✅ **مكتمل بالكامل** - تم إنشاء جميع المكونات المطلوبة

### المكونات المكتملة:
1. ✅ **Controller**: `dashboard/controller/migration/shopify.php` (كان موجود ومتطور)
2. ✅ **Model**: `dashboard/model/migration/shopify.php` (تم إنشاؤه)
3. ✅ **View**: `dashboard/view/template/migration/shopify.twig` (تم إنشاؤه)
4. ✅ **Language**: `dashboard/language/ar/migration/shopify.php` (تم إنشاؤه)
5. ✅ **Database**: جداول قاعدة البيانات موجودة في النظام

## الوظائف الرئيسية

### 1. الاتصال بمتجر شوبيفاي
- إدخال نطاق المتجر (Shop Domain)
- رمز الوصول (Access Token)
- اختيار إصدار API المناسب
- اختبار الاتصال مع Shopify Admin API

### 2. اختيار البيانات للنقل
#### البيانات الأساسية:
- **المنتجات**: جميع أنواع المنتجات مع تنويعاتها
- **العملاء**: بيانات العملاء وعناوينهم
- **الطلبات**: جميع الطلبات بحالاتها المختلفة

#### البيانات الإضافية:
- **مجموعات المنتجات**: Collections المخصصة والذكية
- **كوبونات الخصم**: Discount Codes وقواعد التسعير
- **المخزون**: كميات المنتجات في المواقع المختلفة

### 3. معالجة بيانات شوبيفاي المعقدة
- **تنويعات المنتجات**: Variants مع خصائصها المختلفة
- **الصور**: صور المنتجات والمجموعات
- **الحقول الإضافية**: Metafields المخصصة
- **عمليات التنفيذ**: Fulfillments وحالات الشحن

### 4. معالجة حالات الطلبات المختلفة
#### الحالات المالية:
- **معلقة**: في انتظار الدفع
- **معتمدة**: تم اعتماد الدفع
- **مدفوعة جزئياً**: دفع جزئي
- **مدفوعة**: تم الدفع كاملاً
- **مستردة جزئياً**: استرداد جزئي
- **مستردة**: استرداد كامل
- **ملغية**: تم إلغاء الدفع

#### حالات التنفيذ:
- **غير منفذة**: لم يتم الشحن
- **منفذة جزئياً**: شحن جزئي
- **منفذة**: تم الشحن كاملاً
- **معادة للمخزون**: تم إرجاع المنتجات

### 5. التحقق من صحة البيانات
- فحص تكامل بيانات المنتجات والتنويعات
- التحقق من صحة بيانات العملاء
- مراجعة حالات الطلبات والمعاملات
- كشف البيانات المكررة أو المتضاربة

### 6. ربط الحقول المتقدم
- ربط تلقائي للحقول المتشابهة
- معالجة Metafields المخصصة
- تحويل خصائص التنويعات
- معالجة البيانات الهرمية للمجموعات

## الجداول المرتبطة

### 1. جداول النقل والمراجعة
```sql
- cod_migration: سجل عمليات النقل
- cod_migration_log: سجل تفصيلي للعمليات
- cod_migration_mapping: ربط الحقول
- cod_migration_temp_shopify_*: جداول مؤقتة للبيانات المستوردة من شوبيفاي
```

### 2. جداول البيانات المستهدفة
```sql
- cod_product: المنتجات المنقولة
- cod_product_variation: تنويعات المنتجات
- cod_customer: العملاء المنقولون
- cod_order: الطلبات المنقولة
- cod_order_product: منتجات الطلبات
- cod_category: مجموعات المنتجات
- cod_coupon: كوبونات الخصم
- cod_product_image: صور المنتجات
```

### 3. جداول المطابقة والربط
```sql
- cod_migration_shopify_product_map: ربط معرفات المنتجات
- cod_migration_shopify_customer_map: ربط معرفات العملاء
- cod_migration_shopify_order_map: ربط معرفات الطلبات
- cod_migration_shopify_collection_map: ربط معرفات المجموعات
```

## خطوات عملية النقل

### 1. المرحلة الأولى: الإعداد والاتصال
1. إدخال نطاق متجر شوبيفاي
2. إنشاء تطبيق خاص في شوبيفاي
3. الحصول على رمز الوصول (Access Token)
4. اختبار الاتصال والصلاحيات

### 2. المرحلة الثانية: اختيار البيانات
1. عرض أنواع البيانات المتاحة
2. تحديد البيانات المراد نقلها
3. اختيار نطاق التواريخ للطلبات
4. تحديد حالات الطلبات المطلوبة

### 3. المرحلة الثالثة: استخراج البيانات
1. الاتصال بـ Shopify Admin API
2. استخراج البيانات باستخدام Pagination
3. معالجة البيانات المعقدة (تنويعات، صور)
4. تخزين البيانات في جداول مؤقتة

### 4. المرحلة الرابعة: التحقق والمراجعة
1. فحص تكامل البيانات المستخرجة
2. معالجة البيانات المكررة
3. تحويل تنسيقات البيانات
4. عرض تقرير مفصل للمراجعة

### 5. المرحلة الخامسة: التطبيق النهائي
1. تحويل البيانات إلى تنسيق أيم
2. إنشاء المنتجات وتنويعاتها
3. إدراج العملاء والطلبات
4. ربط العلاقات والمراجع

## الميزات التقنية المتقدمة

### 1. Shopify Admin API Integration
- استخدام Shopify Admin API 2023-10
- معالجة المصادقة بـ Access Token
- إدارة معدل الطلبات (Rate Limiting)
- معالجة الأخطاء والانقطاعات

### 2. معالجة البيانات المعقدة
- تحويل تنويعات المنتجات المعقدة
- معالجة الخصائص والقيم المتعددة
- تحويل Metafields المخصصة
- معالجة الصور والمرفقات

### 3. الأمان والحماية
- تشفير رموز الوصول
- التحقق من صحة البيانات
- حماية من هجمات الحقن
- تسجيل جميع العمليات

### 4. واجهة المستخدم المحسنة
- معالج خطوة بخطوة
- شريط تقدم تفاعلي
- معاينة البيانات المباشرة
- رسائل خطأ واضحة

## خيارات النقل المتقدمة

### 1. أنماط النقل
- **نقل كامل**: جميع البيانات
- **نقل انتقائي**: بيانات محددة
- **نقل تجريبي**: اختبار بدون تطبيق
- **نقل تدريجي**: على مراحل

### 2. خيارات التحويل
- تحويل العملات
- تحويل وحدات القياس
- تعديل الأسعار
- إعادة حساب الضرائب

### 3. معالجة التضارب
- استبدال البيانات الموجودة
- دمج البيانات المتشابهة
- تجاهل البيانات المكررة
- إنشاء نسخ جديدة

## التعامل مع خصائص شوبيفاي

### 1. تنويعات المنتجات
- استخراج Options والقيم
- تحويل Variants إلى منتجات فرعية
- ربط الأسعار والمخزون لكل تنويع
- معالجة الصور لكل تنويع

### 2. المجموعات (Collections)
- تحويل Custom Collections
- معالجة Smart Collections
- ربط المنتجات بالمجموعات
- تحويل قواعد المجموعات الذكية

### 3. كوبونات الخصم
- تحويل Discount Codes
- معالجة Price Rules
- تحويل شروط الاستخدام
- ربط بالمنتجات والمجموعات

### 4. الحقول الإضافية (Metafields)
- استخراج Metafields للمنتجات
- معالجة Metafields للعملاء
- تحويل Metafields للطلبات
- حفظ البيانات الإضافية

## التقارير والسجلات

### 1. تقرير النقل
- عدد المنتجات والتنويعات
- عدد العملاء والطلبات
- إحصائيات المجموعات
- معدل نجاح العملية

### 2. سجل العمليات
- تسجيل تفصيلي لكل API call
- رسائل الخطأ والتحذيرات
- إحصائيات الأداء
- معلومات التشخيص

### 3. تقرير المراجعة
- مقارنة البيانات
- كشف الاختلافات
- تحليل جودة البيانات
- توصيات للتحسين

## التكامل مع النظام

### 1. ربط محاسبي
- إنشاء قيود للطلبات المكتملة
- ربط العملاء بالحسابات
- معالجة الضرائب والخصومات
- تحديث أرصدة العملاء

### 2. تكامل المخزون
- تحديث كميات المنتجات
- إنشاء حركات جرد
- ربط التنويعات بالمخزون
- تحديث تكاليف المنتجات

### 3. تكامل التجارة الإلكترونية
- ربط المنتجات بالمتجر الإلكتروني
- تحديث أسعار البيع
- معالجة الصور والأوصاف
- إعداد خيارات الشحن

## ما بعد النقل

### 1. التحقق من النتائج
- مراجعة المنتجات المنقولة
- اختبار عمليات البيع
- التأكد من صحة التقارير
- مقارنة الأرصدة

### 2. التحسين والضبط
- تحسين أداء النظام
- ضبط إعدادات المتجر
- تحديث قوالب البريد الإلكتروني
- إعداد طرق الدفع والشحن

### 3. التدريب والدعم
- تدريب فريق المبيعات
- دليل استخدام مخصص
- دعم فني متخصص
- حل المشاكل والاستفسارات

## الفوائد التنافسية

### 1. سهولة الانتقال
- عملية نقل مبسطة
- أتمتة معظم الخطوات
- تقليل الوقت والجهد
- تقليل مخاطر فقدان البيانات

### 2. دعم شامل لشوبيفاي
- دعم جميع أنواع المنتجات
- معالجة البيانات المعقدة
- تحويل التطبيقات المخصصة
- حفظ تاريخ المبيعات

### 3. جودة البيانات
- التحقق من صحة البيانات
- تنظيف وتحسين البيانات
- إزالة التكرار
- ضمان تكامل البيانات

## خطة التطوير المستقبلية

### 1. المرحلة الثانية
- دعم تطبيقات شوبيفاي الشائعة
- نقل بيانات التحليلات
- تكامل مع أنظمة الدفع
- مزامنة مستمرة

### 2. المرحلة الثالثة
- نقل تصميم المتجر
- تحويل قوالب Liquid
- دعم المواقع متعددة اللغات
- تحليل ذكي للبيانات

### 3. التحسينات المستمرة
- تحسين واجهة المستخدم
- إضافة خيارات نقل جديدة
- تحسين معالجة الأخطاء
- تطوير أدوات المراجعة

## الخلاصة
شاشة الانتقال من شوبيفاي تعتبر أداة استراتيجية مهمة لجذب أصحاب المتاجر الإلكترونية للانتقال إلى نظام أيم. تم تصميمها لتكون شاملة وموثوقة، مع دعم كامل لجميع ميزات شوبيفاي المعقدة، مما يضمن نقل ناجح وسلس للبيانات مع الحفاظ على جودتها وتكاملها.
