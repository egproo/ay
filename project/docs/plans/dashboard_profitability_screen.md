# شاشة لوحة تحليل الربحية (Dashboard Profitability)

## معلومات الشاشة
- **المسار**: `dashboard/profitability`
- **الترتيب**: الشاشة رقم 5 في العمود الجانبي (ضمن لوحات المعلومات)
- **الأولوية**: عالية جداً - ضرورية لتحليل أداء الشركة المالي

## الحالة الحالية
✅ **مكتمل بالكامل** - تم إنشاء جميع المكونات المطلوبة

### المكونات المكتملة:
1. ✅ **Controller**: `dashboard/controller/dashboard/profitability.php` (كان موجود ومتطور)
2. ✅ **Model**: `dashboard/model/dashboard/profitability.php` (كان موجود ومتطور)
3. ✅ **View**: `dashboard/view/template/dashboard/profitability.twig` (تم إنشاؤه)
4. ✅ **Language**: `dashboard/language/ar/dashboard/profitability.php` (تم إنشاؤه)
5. ✅ **Database**: جداول قاعدة البيانات موجودة في النظام

## الوظائف الرئيسية

### 1. ملخص الربحية
- إجمالي الإيرادات والتكاليف والأرباح
- هامش الربح ونسبة التكلفة
- متوسط قيمة الطلب والربح لكل طلب/عميل
- إجمالي الطلبات والعملاء والمنتجات

### 2. تحليل الاتجاهات
- اتجاهات الربحية عبر الزمن (يومي، أسبوعي، شهري، ربع سنوي، سنوي)
- مقارنة الإيرادات والأرباح والهوامش
- تحليل النمو والانخفاض

### 3. تحليل ربحية المنتجات
- أفضل المنتجات أداءً من ناحية الربح
- المنتجات ذات الهامش المنخفض
- تحليل الكمية المباعة والإيرادات لكل منتج

### 4. تحليل ربحية العملاء
- أفضل العملاء من ناحية الربح
- تحليل ربحية مجموعات العملاء
- متوسط الربح لكل عميل

### 5. تحليل ربحية الفئات
- ربحية كل فئة منتجات
- مقارنة هوامش الربح بين الفئات
- عدد المنتجات في كل فئة

### 6. تحليل ربحية الفروع
- أداء كل فرع من ناحية الربح
- مقارنة الفروع ببعضها البعض
- تحليل التكاليف والإيرادات لكل فرع

### 7. الرؤى والتوصيات
- تحليل ذكي للأداء مع توصيات
- تنبيهات للهوامش المنخفضة
- اقتراحات لتحسين الربحية

## الجداول المرتبطة

### 1. جداول الطلبات والمبيعات
```sql
- cod_order: الطلبات الأساسية
- cod_order_product: منتجات الطلبات
- cod_order_total: إجماليات الطلبات
```

### 2. جداول المنتجات والتكلفة
```sql
- cod_product: بيانات المنتجات الأساسية
- cod_product_description: أوصاف المنتجات
- cod_inventory_valuation: تقييم المخزون والتكلفة
```

### 3. جداول العملاء
```sql
- cod_customer: بيانات العملاء
- cod_customer_group: مجموعات العملاء
- cod_customer_group_description: أوصاف مجموعات العملاء
```

### 4. جداول الفئات والفروع
```sql
- cod_category: فئات المنتجات
- cod_category_description: أوصاف الفئات
- cod_branch: الفروع
- cod_product_to_category: ربط المنتجات بالفئات
```

## المرشحات المتاحة

### 1. مرشحات التاريخ
- من تاريخ / إلى تاريخ
- فترات محددة مسبقاً (اليوم، الأسبوع، الشهر، إلخ)

### 2. مرشحات الموقع
- فلترة حسب الفرع
- جميع الفروع أو فرع محدد

### 3. مرشحات المنتجات
- فلترة حسب فئة المنتجات
- جميع الفئات أو فئة محددة

### 4. مرشحات العملاء
- فلترة حسب مجموعة العملاء
- جميع المجموعات أو مجموعة محددة

### 5. مرشحات التحليل
- نوع التحليل (نظرة عامة، مفصل، مقارنة، اتجاهات)
- فترة التجميع (يومي، أسبوعي، شهري، إلخ)

## المخططات والرسوم البيانية

### 1. مخطط الاتجاهات
- مخطط خطي يعرض الإيرادات والأرباح عبر الزمن
- إمكانية التبديل بين الفترات المختلفة

### 2. مخطط هوامش الربح
- مخطط دائري يعرض توزيع هوامش الربح حسب الفئات
- ألوان مختلفة لكل فئة

### 3. مخططات المقارنة
- مخططات أعمدة لمقارنة الأداء
- مقارنة بين الفروع أو الفئات أو الفترات

## الميزات التقنية

### 1. التحديث المباشر
- إمكانية تحديث البيانات بضغطة زر
- تحديث تلقائي للمخططات والجداول

### 2. التصدير
- تصدير البيانات إلى Excel
- تصدير التقارير إلى PDF
- تصدير البيانات الخام إلى CSV

### 3. الأداء
- استخدام فهارس قاعدة البيانات لتسريع الاستعلامات
- تخزين مؤقت للبيانات المحسوبة
- تحميل تدريجي للبيانات الكبيرة

### 4. الأمان
- فحص الصلاحيات على جميع المستويات
- تشفير البيانات الحساسة
- تسجيل جميع العمليات في سجل التدقيق

## التكامل مع النظام

### 1. ربط محاسبي
- حساب الأرباح من البيانات المحاسبية الفعلية
- ربط مع دليل الحسابات
- تحديث تلقائي عند تغيير البيانات المحاسبية

### 2. تكامل المخزون
- حساب التكلفة من نظام الجرد المستمر
- استخدام طريقة المتوسط المرجح للتكلفة
- تحديث فوري عند تغيير تكاليف المنتجات

### 3. تكامل المبيعات
- ربط مباشر مع طلبات البيع
- تحديث فوري عند إضافة طلبات جديدة
- حساب الخصومات والضرائب

### 4. تكامل العملاء
- ربط مع بيانات العملاء ومجموعاتهم
- تحليل سلوك العملاء الشرائي
- حساب قيمة العميل مدى الحياة

## الاستخدام المستهدف

### 1. الإدارة العليا
- متابعة الأداء المالي العام
- اتخاذ قرارات استراتيجية
- مراقبة تحقيق الأهداف المالية

### 2. المدراء الماليين
- تحليل الربحية بالتفصيل
- تحديد مصادر الربح والخسارة
- تخطيط الميزانيات والتوقعات

### 3. مدراء المبيعات
- تحليل أداء المنتجات والعملاء
- تحديد الفرص التجارية
- تحسين استراتيجيات البيع

### 4. مدراء الفروع
- متابعة أداء فروعهم
- مقارنة الأداء مع الفروع الأخرى
- تحديد نقاط التحسين

## المؤشرات الرئيسية (KPIs)

### 1. مؤشرات الربحية
- هامش الربح الإجمالي
- هامش الربح الصافي
- العائد على الاستثمار (ROI)
- العائد على الأصول (ROA)

### 2. مؤشرات الكفاءة
- معدل دوران المخزون
- متوسط فترة التحصيل
- نسبة التكلفة إلى الإيرادات
- إنتاجية الموظف

### 3. مؤشرات النمو
- نمو الإيرادات
- نمو الأرباح
- نمو قاعدة العملاء
- نمو متوسط قيمة الطلب

## خطة التطوير المستقبلية

### 1. المرحلة الثانية
- إضافة تحليل التنبؤات المالية
- تكامل مع أنظمة BI خارجية
- تحليل متقدم باستخدام الذكاء الاصطناعي

### 2. المرحلة الثالثة
- تحليل ربحية المشاريع
- تحليل التكلفة حسب النشاط (ABC)
- تحليل الحساسية والسيناريوهات

### 3. التحسينات المستمرة
- تحسين أداء الاستعلامات
- إضافة مؤشرات جديدة
- تحسين واجهة المستخدم

## الخلاصة
شاشة تحليل الربحية تعتبر من أهم الشاشات في النظام لأنها توفر رؤية شاملة عن الأداء المالي للشركة. تم تصميمها لتكون سهلة الاستخدام ومرنة في التحليل، مع إمكانيات تصدير متقدمة وتكامل كامل مع باقي أجزاء النظام.
