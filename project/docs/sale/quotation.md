# توثيق شاشة عروض أسعار المبيعات (Quotation)

---

## 1. وصف الشاشة
شاشة إدارة عروض أسعار المبيعات تتيح إنشاء وتعديل وعرض وطباعة وتحويل عروض الأسعار للعملاء، مع دعم وحدات المنتجات، الضرائب، الخصومات، الربط بالعملاء والفروع والمستخدمين، وإرسال العروض بالبريد الإلكتروني.

---

## 2. الجداول المرتبطة

### جدول رئيسي: `cod_sales_quotation`
| الحقل              | النوع           | الوصف                        |
|--------------------|-----------------|------------------------------|
| quotation_id       | int             | رقم العرض (مفتاح أساسي)      |
| quotation_number   | varchar(50)     | رقم العرض                    |
| customer_id        | int             | رقم العميل (FK)              |
| branch_id          | int             | رقم الفرع (FK)               |
| quotation_date     | date            | تاريخ العرض                  |
| valid_until        | date            | تاريخ انتهاء الصلاحية        |
| status             | varchar(20)     | حالة العرض                   |
| total_amount       | decimal(15,4)   | إجمالي العرض                 |
| discount_amount    | decimal(15,4)   | إجمالي الخصم                 |
| tax_amount         | decimal(15,4)   | إجمالي الضريبة               |
| net_amount         | decimal(15,4)   | الصافي بعد الخصم والضريبة     |
| notes              | text            | ملاحظات                      |
| converted_to_order | tinyint(1)      | تم التحويل لطلب بيع؟         |
| order_id           | int             | رقم الطلب الناتج (FK)         |
| created_by         | int             | المستخدم المنشئ (FK)         |
| created_at         | datetime        | تاريخ الإنشاء                |

### جدول العناصر: `cod_sales_quotation_item`
| الحقل         | النوع           | الوصف                        |
|---------------|-----------------|------------------------------|
| item_id       | int             | رقم العنصر (مفتاح أساسي)     |
| quotation_id  | int             | رقم العرض (FK)               |
| product_id    | int             | رقم المنتج (FK)               |
| unit_id       | int             | رقم الوحدة (FK)               |
| quantity      | decimal(15,4)   | الكمية                        |
| price         | decimal(15,4)   | السعر                         |
| discount_rate | decimal(5,2)    | نسبة الخصم                    |
| tax_rate      | decimal(5,2)    | نسبة الضريبة                  |
| total         | decimal(15,4)   | الإجمالي                      |
| notes         | text            | ملاحظات                      |

### جداول مساعدة ومشتركة:
- cod_customer (العملاء)
- cod_branch (الفروع)
- cod_user (المستخدمون)
- cod_product (المنتجات)
- cod_unit (الوحدات)
- cod_activity_log (سجل الأنشطة)
- cod_notification (الإشعارات)
- cod_message (الرسائل)
- cod_workflow_instance (سير العمل)

---

## 3. العلاقات والاعتماديات
- كل عرض سعر مرتبط بعميل، فرع، مستخدم منشئ.
- كل عنصر عرض سعر مرتبط بمنتج ووحدة.
- عند التحويل إلى طلب بيع: يرتبط بـ order_id.
- دعم مبدئي للإشعارات وسير العمل (activity log، لكن workflow يحتاج تطوير وربط أعمق).
- لا يوجد جدول منفصل للخيارات (options) في عرض السعر (يمكن تحسين ذلك).

---

## 4. العيوب الحالية
- لا يوجد دعم متكامل للخيارات (Product Options) في عرض السعر.
- لا يوجد سجل تاريخي لتغييرات الحالة (status history) أو توقيعات إلكترونية.
- لا يوجد ربط مباشر مع مركز الإشعارات أو التواصل الداخلي.
- لا يوجد دعم متكامل لسير العمل المرئي أو الموافقات المتعددة.
- واجهة المستخدم جيدة لكن يمكن تطويرها لتكون أسرع وأكثر تفاعلية.

---

## 5. خطة التحسين للوصول لمستوى عالمي
- إضافة دعم كامل للخيارات (options) والخصائص المتقدمة للمنتجات.
- إضافة سجل تاريخي للحالة (status history) وتوقيعات إلكترونية (signatures).
- ربط متكامل مع مركز الإشعارات والتواصل الداخلي.
- دعم سير العمل المرئي (workflow) والموافقات المتعددة (multi-level approval).
- تحسين واجهة المستخدم لتكون أسرع وأكثر تفاعلية (SPA/React/Vue).
- إضافة دعم كامل للتكامل مع CRM والحملات التسويقية.
- إضافة دعم كامل للربط مع نظام التقسيط والعروض الترويجية.
- توثيق كل الحقول والعلاقات في هذا الملف وتحديثه باستمرار. 