CREATE TABLE cod_abandoned_cart (
  cart_id int NOT NULL,
  customer_id int DEFAULT NULL,
  session_id varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  date_created datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  last_activity datetime NOT NULL,
  items_count int NOT NULL DEFAULT '0',
  total_value decimal(15,4) NOT NULL DEFAULT '0.0000',
  status varchar(20) COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  recovery_email_sent tinyint(1) NOT NULL DEFAULT '0',
  email_sent_date datetime DEFAULT NULL,
  recovery_date datetime DEFAULT NULL,
  order_id int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_abandoned_cart_recovery (
  recovery_id int NOT NULL,
  cart_id int NOT NULL,
  user_id int NOT NULL,
  type varchar(20) COLLATE utf8mb4_general_ci NOT NULL,
  data text COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_abandoned_cart_template (
  template_id int NOT NULL,
  name varchar(100) COLLATE utf8mb4_general_ci NOT NULL,
  type varchar(20) COLLATE utf8mb4_general_ci NOT NULL,
  subject varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  content text COLLATE utf8mb4_general_ci NOT NULL,
  created_by int NOT NULL,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_accounts (
  account_id int NOT NULL,
  image varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  parent_id bigint NOT NULL DEFAULT '0',
  account_code bigint NOT NULL,
  status tinyint(1) NOT NULL,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  account_type enum('debit','credit') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'debit'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_account_description (
  account_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_activity_log (
  log_id int NOT NULL,
  user_id int NOT NULL,
  action_type varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  module varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci NOT NULL,
  ip_address varchar(45) COLLATE utf8mb4_general_ci DEFAULT NULL,
  user_agent varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  reference_type varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  reference_id int DEFAULT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_address (
  address_id int NOT NULL,
  customer_id int NOT NULL,
  firstname varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  lastname varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  company varchar(40) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  address_1 varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  address_2 varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  city varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  postcode varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  country_id int NOT NULL DEFAULT '63',
  zone_id int NOT NULL DEFAULT '0',
  custom_field mediumtext COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_api (
  api_id int NOT NULL,
  username varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  `key` mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL,
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_api_ip (
  api_ip_id int NOT NULL,
  api_id int NOT NULL,
  ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_api_session (
  api_session_id int NOT NULL,
  api_id int NOT NULL,
  session_id varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_asset_types (
  asset_type_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_attendance (
  attendance_id int NOT NULL,
  user_id int NOT NULL,
  date date NOT NULL,
  checkin_time datetime DEFAULT NULL,
  checkout_time datetime DEFAULT NULL,
  status enum('present','absent','late','on_leave') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'present',
  notes text COLLATE utf8mb4_general_ci,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_attribute (
  attribute_id int NOT NULL,
  attribute_group_id int NOT NULL,
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_attribute_description (
  attribute_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_attribute_group (
  attribute_group_id int NOT NULL,
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_attribute_group_description (
  attribute_group_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_audit_log (
  log_id int NOT NULL,
  user_id int NOT NULL,
  action varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  reference_type varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  reference_id int DEFAULT NULL,
  before_data mediumtext COLLATE utf8mb4_general_ci,
  after_data mediumtext COLLATE utf8mb4_general_ci,
  timestamp datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_audit_plan (
  plan_id int NOT NULL,
  title varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  year int NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  status enum('draft','approved','in_progress','completed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'draft',
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  approved_by int DEFAULT NULL,
  approved_at datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_audit_task (
  task_id int NOT NULL,
  plan_id int DEFAULT NULL,
  title varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  department varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  process varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  risk_level enum('low','medium','high') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'medium',
  status enum('pending','in_progress','completed','cancelled') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  start_date date DEFAULT NULL,
  due_date date DEFAULT NULL,
  assigned_to int DEFAULT NULL,
  completed_at datetime DEFAULT NULL,
  findings text COLLATE utf8mb4_general_ci,
  recommendations text COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_bank (
  bank_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  account_number varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  account_code bigint NOT NULL,
  branch varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  swift_code varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  address text COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL DEFAULT '1',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_bank_account (
  account_id int NOT NULL,
  account_name varchar(100) COLLATE utf8mb4_general_ci NOT NULL,
  bank_name varchar(100) COLLATE utf8mb4_general_ci NOT NULL,
  account_number varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  currency varchar(3) COLLATE utf8mb4_general_ci NOT NULL,
  current_balance decimal(15,4) NOT NULL,
  account_type enum('bank','credit_card','e_wallet') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'bank'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_bank_reconciliation (
  reconciliation_id int NOT NULL,
  bank_account_id int NOT NULL,
  statement_date date NOT NULL,
  statement_opening_balance decimal(15,4) NOT NULL,
  statement_closing_balance decimal(15,4) NOT NULL,
  system_closing_balance decimal(15,4) NOT NULL COMMENT 'الرصيد المتوقع في النظام قبل التسوية',
  difference decimal(15,4) NOT NULL COMMENT 'الفارق إن وجد',
  status enum('open','closed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'open',
  notes text COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_bank_transaction (
  bank_transaction_id int NOT NULL,
  journal_id int NOT NULL DEFAULT '0',
  bank_account_id int NOT NULL,
  transaction_date datetime NOT NULL,
  transaction_type enum('deposit','withdraw','transfer_in','transfer_out','check_in','check_out') COLLATE utf8mb4_general_ci NOT NULL,
  amount decimal(15,4) NOT NULL,
  reference varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  description text COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_banner (
  banner_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_banner_image (
  banner_image_id int NOT NULL,
  banner_id int NOT NULL,
  language_id int NOT NULL,
  title varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  link varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  image varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  sort_order int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_blog_category (
  category_id int NOT NULL,
  parent_id int NOT NULL DEFAULT '0',
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  slug varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  image varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  meta_title varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  meta_description text COLLATE utf8mb4_general_ci,
  meta_keywords varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  status tinyint(1) NOT NULL DEFAULT '1',
  sort_order int NOT NULL DEFAULT '0',
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_blog_comment (
  comment_id int NOT NULL,
  post_id int NOT NULL,
  parent_id int NOT NULL DEFAULT '0',
  author varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  email varchar(96) COLLATE utf8mb4_general_ci NOT NULL,
  website varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  content text COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL DEFAULT '0',
  notify tinyint(1) NOT NULL DEFAULT '0',
  ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_blog_post (
  post_id int NOT NULL,
  author_id int NOT NULL,
  title varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  slug varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  short_description text COLLATE utf8mb4_general_ci,
  content longtext COLLATE utf8mb4_general_ci NOT NULL,
  meta_title varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  meta_description text COLLATE utf8mb4_general_ci,
  meta_keywords varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  featured_image varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  status tinyint(1) NOT NULL DEFAULT '0',
  comment_status tinyint(1) NOT NULL DEFAULT '1',
  sort_order int NOT NULL DEFAULT '0',
  hits int NOT NULL DEFAULT '0',
  date_published datetime DEFAULT NULL,
  date_created datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_blog_post_to_category (
  post_id int NOT NULL,
  category_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_blog_post_to_tag (
  post_id int NOT NULL,
  tag_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_blog_tag (
  tag_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  slug varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_branch (
  branch_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  address_id int NOT NULL,
  type enum('store','warehouse') COLLATE utf8mb4_general_ci NOT NULL,
  eta_branch_id varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  available_online tinyint(1) NOT NULL DEFAULT '0',
  telephone varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  email varchar(96) COLLATE utf8mb4_general_ci NOT NULL,
  manager_id int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_branch_address (
  address_id int NOT NULL,
  branch_id int NOT NULL,
  firstname varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  lastname varchar(32) COLLATE utf8mb4_general_ci DEFAULT NULL,
  company varchar(40) COLLATE utf8mb4_general_ci DEFAULT NULL,
  address_1 varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  address_2 varchar(128) COLLATE utf8mb4_general_ci DEFAULT NULL,
  city varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  postcode varchar(10) COLLATE utf8mb4_general_ci DEFAULT NULL,
  country_id int NOT NULL,
  zone_id int NOT NULL,
  custom_field mediumtext COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_branch_inventory_snapshot (
  snapshot_id int NOT NULL,
  branch_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  snapshot_date datetime NOT NULL,
  quantity decimal(15,4) NOT NULL,
  average_cost decimal(15,4) NOT NULL,
  last_movement_id int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_budget (
  budget_id int NOT NULL,
  budget_name varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  period_start date NOT NULL,
  period_end date NOT NULL,
  status varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'draft',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  approved_by int DEFAULT NULL,
  approved_at datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_budget_line (
  line_id int NOT NULL,
  budget_id int NOT NULL,
  account_code bigint NOT NULL,
  branch_id int DEFAULT NULL,
  department_id int DEFAULT NULL,
  amount decimal(15,4) NOT NULL,
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_cart (
  cart_id int UNSIGNED NOT NULL,
  api_id int NOT NULL,
  customer_id int NOT NULL,
  session_id varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL DEFAULT '37',
  recurring_id int NOT NULL,
  `option` mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  quantity int NOT NULL,
  price decimal(15,4) DEFAULT NULL,
  is_free tinyint(1) NOT NULL DEFAULT '0',
  bundle_id int DEFAULT NULL,
  product_quantity_discount_id int DEFAULT NULL,
  group_id int DEFAULT NULL,
  selected_bundles text COLLATE utf8mb4_general_ci,
  bundle_options text COLLATE utf8mb4_general_ci,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_cash (
  cash_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  account_code bigint NOT NULL,
  responsible_user_id int NOT NULL,
  status tinyint(1) NOT NULL DEFAULT '1',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_cash_transaction (
  cash_transaction_id int NOT NULL,
  journal_id int NOT NULL DEFAULT '0',
  cash_id int NOT NULL COMMENT 'الخزنة/الصندوق المرتبط',
  transaction_type enum('cash_in','cash_out') COLLATE utf8mb4_general_ci NOT NULL COMMENT 'إيداع أو سحب',
  amount decimal(15,4) NOT NULL,
  reference varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'مثلاً رقم فاتورة البيع أو قيد محاسبي',
  note text COLLATE utf8mb4_general_ci COMMENT 'ملاحظات عامة',
  created_by int NOT NULL COMMENT 'user_id الذي قام بالتسجيل',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_category (
  category_id int NOT NULL,
  image varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  parent_id int NOT NULL DEFAULT '0',
  top tinyint(1) NOT NULL,
  `column` int NOT NULL,
  sort_order int NOT NULL DEFAULT '0',
  status tinyint(1) NOT NULL,
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_category_description (
  category_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  meta_title varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  meta_description varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  meta_keyword varchar(255) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_category_filter (
  category_id int NOT NULL,
  filter_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_category_path (
  category_id int NOT NULL,
  path_id int NOT NULL,
  level int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_category_to_layout (
  category_id int NOT NULL,
  store_id int NOT NULL,
  layout_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_category_to_store (
  category_id int NOT NULL,
  store_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_checks (
  check_id int NOT NULL,
  check_number varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  check_type enum('incoming','outgoing') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'incoming',
  bank_account_id int DEFAULT NULL,
  payee_name varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  issue_date date NOT NULL,
  due_date date NOT NULL,
  amount decimal(15,4) NOT NULL,
  currency_id int DEFAULT NULL,
  status enum('outstanding','cleared','bounced','cancelled') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'outstanding',
  reference varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  description text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  updated_by int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_compliance_record (
  compliance_id int NOT NULL,
  compliance_type varchar(100) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'مثلاً: إقرار ضريبي، التأمينات الاجتماعية، بيئي، إلخ',
  reference_code varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'رقم المستند الرسمي لدى الجهة المختصة',
  description text COLLATE utf8mb4_general_ci COMMENT 'تفاصيل الالتزام',
  due_date date DEFAULT NULL COMMENT 'تاريخ الاستحقاق أو آخر موعد لتقديم الإقرار',
  status enum('pending','submitted','approved','rejected','closed') COLLATE utf8mb4_general_ci DEFAULT 'pending',
  responsible_user_id int DEFAULT NULL COMMENT 'المسؤول عن المتابعة',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_consignment_inventory (
  consignment_id int NOT NULL,
  product_id int NOT NULL,
  supplier_id int NOT NULL,
  quantity decimal(15,4) NOT NULL DEFAULT '0.0000',
  unit_id int NOT NULL,
  start_date date NOT NULL,
  end_date date DEFAULT NULL,
  status enum('active','returned','sold') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  created_at datetime NOT NULL,
  updated_at datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_cost_calculation_settings (
  setting_id int NOT NULL,
  cost_method enum('weighted_average','fifo','specific') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'weighted_average' COMMENT 'طريقة حساب التكلفة',
  apply_price_variance_to enum('inventory','expense','proportional') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'proportional' COMMENT 'طريقة معالجة فروق الأسعار',
  variance_threshold_percentage decimal(5,2) NOT NULL DEFAULT '2.00' COMMENT 'نسبة العتبة لاعتبار الفرق كبيرًا',
  update_cost_on_return tinyint(1) NOT NULL DEFAULT '1' COMMENT 'تحديث التكلفة عند الإرجاع',
  transfer_cost_method enum('source_cost','fixed_cost','include_transfer_cost') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'source_cost' COMMENT 'طريقة نقل التكلفة عند التحويل',
  batch_tracking_enabled tinyint(1) NOT NULL DEFAULT '0' COMMENT 'تفعيل تتبع الدفعات',
  expiry_tracking_enabled tinyint(1) NOT NULL DEFAULT '0' COMMENT 'تفعيل تتبع تاريخ الصلاحية',
  allow_negative_inventory tinyint(1) NOT NULL DEFAULT '0' COMMENT 'السماح بالمخزون السالب',
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_country (
  country_id int NOT NULL,
  name varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  iso_code_2 varchar(2) COLLATE utf8mb4_general_ci NOT NULL,
  iso_code_3 varchar(3) COLLATE utf8mb4_general_ci NOT NULL,
  address_format mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  postcode_required tinyint(1) NOT NULL,
  status tinyint(1) NOT NULL DEFAULT '1'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_coupon (
  coupon_id int NOT NULL,
  name varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(20) COLLATE utf8mb4_general_ci NOT NULL,
  type char(1) COLLATE utf8mb4_general_ci NOT NULL,
  discount decimal(15,4) NOT NULL,
  logged tinyint(1) NOT NULL,
  shipping tinyint(1) NOT NULL,
  total decimal(15,4) NOT NULL,
  date_start date DEFAULT NULL,
  date_end date DEFAULT NULL,
  uses_total int NOT NULL,
  uses_customer varchar(11) COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_coupon_category (
  coupon_id int NOT NULL,
  category_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_coupon_history (
  coupon_history_id int NOT NULL,
  coupon_id int NOT NULL,
  order_id int NOT NULL,
  customer_id int NOT NULL,
  amount decimal(15,4) NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_coupon_product (
  coupon_product_id int NOT NULL,
  coupon_id int NOT NULL,
  product_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_crm_campaign (
  campaign_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  type enum('seo','adwords','social_media','email','other') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'other',
  start_date date NOT NULL,
  end_date date NOT NULL,
  budget decimal(15,4) NOT NULL DEFAULT '0.0000',
  code varchar(64) COLLATE utf8mb4_general_ci DEFAULT NULL,
  status enum('active','inactive','completed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  notes text COLLATE utf8mb4_general_ci,
  assigned_to_user_id int DEFAULT NULL,
  actual_spend decimal(15,4) NOT NULL DEFAULT '0.0000',
  invoice_reference varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  add_expense tinyint(1) NOT NULL DEFAULT '0',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_crm_contact (
  contact_id int NOT NULL,
  firstname varchar(100) COLLATE utf8mb4_general_ci NOT NULL,
  lastname varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  email varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  phone varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  position varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  notes text COLLATE utf8mb4_general_ci,
  status enum('active','inactive') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  assigned_to_user_id int DEFAULT NULL,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_crm_deal (
  deal_id int NOT NULL,
  account_id int DEFAULT NULL,
  opportunity_id int DEFAULT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  stage enum('qualification','proposal','negotiation','closed_won','closed_lost') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'qualification',
  amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  probability decimal(5,2) NOT NULL DEFAULT '0.00',
  expected_close_date date DEFAULT NULL,
  status enum('open','closed','on_hold') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'open',
  assigned_to_user_id int DEFAULT NULL,
  notes text COLLATE utf8mb4_general_ci,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_crm_lead (
  lead_id int NOT NULL,
  firstname varchar(100) COLLATE utf8mb4_general_ci NOT NULL,
  lastname varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  company varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  email varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  phone varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  source varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  status enum('new','contacted','qualified','unqualified','converted') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'new',
  assigned_to_user_id int DEFAULT NULL,
  notes text COLLATE utf8mb4_general_ci,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_crm_opportunity (
  opportunity_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  lead_id int DEFAULT NULL,
  stage enum('qualification','proposal','negotiation','closed_won','closed_lost') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'qualification',
  probability decimal(5,2) NOT NULL DEFAULT '0.00',
  amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  close_date date DEFAULT NULL,
  assigned_to_user_id int DEFAULT NULL,
  notes text COLLATE utf8mb4_general_ci,
  status enum('open','closed','on_hold') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'open',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_currency (
  currency_id int NOT NULL,
  title varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(3) COLLATE utf8mb4_general_ci NOT NULL,
  symbol_left varchar(12) COLLATE utf8mb4_general_ci NOT NULL,
  symbol_right varchar(12) COLLATE utf8mb4_general_ci NOT NULL,
  decimal_place char(1) COLLATE utf8mb4_general_ci NOT NULL,
  value double(15,8) NOT NULL,
  status tinyint(1) NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_currency_rate_history (
  rate_history_id int NOT NULL,
  currency_id int NOT NULL,
  rate_date date NOT NULL,
  exchange_rate decimal(15,8) NOT NULL,
  changed_by int DEFAULT NULL,
  note text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer (
  customer_id int NOT NULL,
  account_code bigint DEFAULT NULL,
  customer_group_id int NOT NULL,
  store_id int NOT NULL DEFAULT '0',
  language_id int NOT NULL,
  firstname varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  lastname varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  email varchar(96) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  telephone varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  fax varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  password varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  salt varchar(9) COLLATE utf8mb4_general_ci NOT NULL,
  cart mediumtext COLLATE utf8mb4_general_ci,
  wishlist mediumtext COLLATE utf8mb4_general_ci,
  newsletter tinyint(1) NOT NULL DEFAULT '0',
  address_id int NOT NULL DEFAULT '0',
  custom_field mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL,
  safe tinyint(1) NOT NULL,
  is_vip tinyint(1) NOT NULL DEFAULT '0',
  vip_level varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  vip_since date DEFAULT NULL,
  vip_notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  token mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_activity (
  customer_activity_id int NOT NULL,
  customer_id int NOT NULL,
  `key` varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  data mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_affiliate (
  customer_id int NOT NULL,
  company varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  website varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  tracking varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  commission decimal(4,2) NOT NULL DEFAULT '0.00',
  tax varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  payment varchar(6) COLLATE utf8mb4_general_ci NOT NULL,
  cheque varchar(100) COLLATE utf8mb4_general_ci NOT NULL,
  paypal varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  bank_name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  bank_branch_number varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  bank_swift_code varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  bank_account_name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  bank_account_number varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  custom_field mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_approval (
  customer_approval_id int NOT NULL,
  customer_id int NOT NULL,
  type varchar(9) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_credit_limit (
  limit_id int NOT NULL,
  customer_id int NOT NULL,
  credit_limit decimal(15,4) NOT NULL DEFAULT '0.0000',
  current_balance decimal(15,4) NOT NULL DEFAULT '0.0000',
  payment_terms int DEFAULT NULL COMMENT 'فترة السداد بالأيام',
  status enum('active','suspended','pending_approval') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  approved_by int DEFAULT NULL,
  approval_date datetime DEFAULT NULL,
  last_review_date date DEFAULT NULL,
  notes text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_feedback (
  feedback_id int NOT NULL,
  customer_id int NOT NULL,
  feedback_type enum('complaint','suggestion','inquiry','appreciation') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  subject varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  description text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  status enum('new','in_progress','resolved','closed','cancelled') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'new',
  priority enum('low','medium','high','critical') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'medium',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  closed_at datetime DEFAULT NULL,
  reference_module varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'المودل المرتبط مثل order, product',
  reference_id int DEFAULT NULL COMMENT 'معرف المرجع',
  assigned_to int DEFAULT NULL COMMENT 'الموظف المسؤول',
  satisfaction_rating int DEFAULT NULL COMMENT 'تقييم رضا العميل (1-5)',
  source enum('website','email','phone','social_media','in_store','app') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'website'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_group (
  customer_group_id int NOT NULL,
  approval int NOT NULL,
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_group_description (
  customer_group_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  description mediumtext COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_history (
  customer_history_id int NOT NULL,
  customer_id int NOT NULL,
  comment mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_ip (
  customer_ip_id int NOT NULL,
  customer_id int NOT NULL,
  ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_login (
  customer_login_id int NOT NULL,
  email varchar(96) COLLATE utf8mb4_general_ci NOT NULL,
  ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  total int NOT NULL,
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_note (
  note_id int NOT NULL,
  customer_id int NOT NULL,
  note mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_online (
  ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  customer_id int NOT NULL,
  url mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  referer mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_return_inventory (
  return_inventory_id int NOT NULL,
  return_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  branch_id int NOT NULL,
  quantity decimal(15,4) NOT NULL,
  return_to_stock tinyint(1) NOT NULL DEFAULT '1' COMMENT 'هل ترجع للمخزون أم تالفة',
  updated_inventory tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل تم تحديث المخزون',
  movement_id int DEFAULT NULL COMMENT 'معرف حركة المخزون',
  journal_id int DEFAULT NULL COMMENT 'معرف القيد المحاسبي',
  notes text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_reward (
  customer_reward_id int NOT NULL,
  customer_id int NOT NULL DEFAULT '0',
  order_id int NOT NULL DEFAULT '0',
  description mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  points int NOT NULL DEFAULT '0',
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_search (
  customer_search_id int NOT NULL,
  store_id int NOT NULL,
  language_id int NOT NULL,
  customer_id int NOT NULL,
  keyword varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  category_id int DEFAULT NULL,
  sub_category tinyint(1) NOT NULL,
  description tinyint(1) NOT NULL,
  products int NOT NULL,
  ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_transaction (
  customer_transaction_id int NOT NULL,
  customer_id int NOT NULL,
  order_id int NOT NULL,
  description mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  amount decimal(15,4) NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_customer_wishlist (
  customer_id int NOT NULL,
  product_id int NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_custom_field (
  custom_field_id int NOT NULL,
  type varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  value mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  validation varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  location varchar(10) COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL,
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_custom_field_customer_group (
  custom_field_id int NOT NULL,
  customer_group_id int NOT NULL,
  required tinyint(1) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_custom_field_description (
  custom_field_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(128) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_custom_field_value (
  custom_field_value_id int NOT NULL,
  custom_field_id int NOT NULL,
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_custom_field_value_description (
  custom_field_value_id int NOT NULL,
  language_id int NOT NULL,
  custom_field_id int NOT NULL,
  name varchar(128) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_custom_report (
  report_id int NOT NULL,
  report_name varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  description text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  report_query text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  parameters text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  output_format varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'table',
  is_public tinyint(1) NOT NULL DEFAULT '0',
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_dashboard_kpi (
  kpi_id int NOT NULL,
  kpi_code varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  kpi_name varchar(100) COLLATE utf8mb4_general_ci NOT NULL,
  kpi_description text COLLATE utf8mb4_general_ci,
  kpi_value decimal(15,4) NOT NULL DEFAULT '0.0000',
  kpi_target decimal(15,4) DEFAULT NULL,
  kpi_unit varchar(20) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'مثل: ريال، %، عدد',
  period varchar(20) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'مثل: daily, weekly, monthly, yearly',
  period_date date NOT NULL,
  display_order int NOT NULL DEFAULT '0',
  is_active tinyint(1) NOT NULL DEFAULT '1',
  display_on_dashboard tinyint(1) NOT NULL DEFAULT '1',
  widget_size varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'medium',
  chart_type varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  comparison_period varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  widget_order int NOT NULL DEFAULT '0',
  widget_color varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT 'blue',
  trend_days int NOT NULL DEFAULT '30',
  last_updated datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_dashboard_widget (
  widget_id varchar(64) NOT NULL,
  name varchar(255) NOT NULL,
  type varchar(32) NOT NULL,
  category varchar(32) NOT NULL,
  description text,
  enabled tinyint(1) NOT NULL DEFAULT 1,
  data_method varchar(64),
  refresh_interval int DEFAULT 120,
  is_system tinyint(1) NOT NULL DEFAULT 0,
  created_at datetime DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (widget_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_user_dashboard (
  dashboard_id int NOT NULL AUTO_INCREMENT,
  user_id int NOT NULL,
  name varchar(255) NOT NULL,
  is_default tinyint(1) NOT NULL DEFAULT 0,
  layout_config mediumtext,
  settings_config mediumtext,
  created_at datetime DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (dashboard_id),
  KEY user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_dashboard_kpi (
  kpi_id int NOT NULL AUTO_INCREMENT,
  name varchar(255) NOT NULL,
  category varchar(32) NOT NULL,
  value decimal(15,4) NOT NULL DEFAULT 0,
  target decimal(15,4),
  trend decimal(15,4),
  previous_value decimal(15,4),
  date_range varchar(32) NOT NULL,
  branch_id int,
  last_calculated datetime,
  created_at datetime DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (kpi_id),
  KEY branch_id (branch_id),
  KEY category (category)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_system_notifications (
  notification_id int NOT NULL AUTO_INCREMENT,
  title varchar(255) NOT NULL,
  content text NOT NULL,
  type varchar(32) NOT NULL,
  priority varchar(16) DEFAULT 'normal',
  link varchar(255),
  created_at datetime DEFAULT CURRENT_TIMESTAMP,
  expires_at datetime,
  PRIMARY KEY (notification_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_notification_user (
  notification_id int NOT NULL,
  user_id int NOT NULL,
  is_read tinyint(1) NOT NULL DEFAULT 0,
  read_at datetime,
  created_at datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (notification_id, user_id),
  KEY user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_internal_conversation (
  conversation_id int NOT NULL AUTO_INCREMENT,
  title varchar(255),
  created_by int NOT NULL,
  created_at datetime DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (conversation_id),
  KEY created_by (created_by)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_internal_message (
  message_id int NOT NULL AUTO_INCREMENT,
  conversation_id int NOT NULL,
  sender_id int NOT NULL,
  content text NOT NULL,
  created_at datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (message_id),
  KEY conversation_id (conversation_id),
  KEY sender_id (sender_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_message_recipient (
  message_id int NOT NULL,
  user_id int NOT NULL,
  is_read tinyint(1) NOT NULL DEFAULT 0,
  read_at datetime,
  created_at datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (message_id, user_id),
  KEY user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_data_access_control (
  access_id int NOT NULL,
  user_id int DEFAULT NULL,
  user_group_id int DEFAULT NULL,
  resource_type varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'branch, product_category, etc',
  resource_id int NOT NULL,
  permission_level varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'view',
  granted_by int NOT NULL,
  granted_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_document_permission (
  permission_id int NOT NULL,
  document_id int NOT NULL,
  user_id int DEFAULT NULL COMMENT 'user_id أو NULL إذا كان للمجموعة',
  user_group_id int DEFAULT NULL COMMENT 'user_group_id أو NULL إذا كان للمستخدم',
  permission_type enum('view','edit','delete','approve','share') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'view',
  granted_by int NOT NULL,
  granted_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  expires_at datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_dynamic_pricing_rule (
  rule_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  type enum('percentage','fixed','formula') COLLATE utf8mb4_general_ci NOT NULL,
  value decimal(15,4) NOT NULL,
  formula text COLLATE utf8mb4_general_ci,
  condition_type enum('customer_group','total_spent','purchase_history','time_period','stock_level','competitor_price') COLLATE utf8mb4_general_ci NOT NULL,
  condition_value text COLLATE utf8mb4_general_ci NOT NULL,
  priority int NOT NULL DEFAULT '0',
  date_start date DEFAULT NULL,
  date_end date DEFAULT NULL,
  status tinyint(1) NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_employee_advance (
  advance_id int NOT NULL,
  user_id int NOT NULL,
  request_date date NOT NULL,
  amount decimal(15,4) NOT NULL,
  status enum('pending','approved','rejected','settled') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_by int DEFAULT NULL,
  updated_at datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_employee_advance_installment (
  installment_id int NOT NULL,
  advance_id int NOT NULL,
  installment_number int NOT NULL,
  due_date date NOT NULL,
  amount decimal(15,4) NOT NULL,
  paid_date date DEFAULT NULL,
  paid_amount decimal(15,4) DEFAULT NULL,
  status enum('unpaid','paid','partial') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'unpaid',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_employee_documents (
  document_id int NOT NULL,
  employee_id int NOT NULL,
  document_name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  file_path varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_employee_profile (
  employee_id int NOT NULL,
  user_id int NOT NULL,
  job_title varchar(100) COLLATE utf8mb4_general_ci NOT NULL,
  hiring_date date NOT NULL,
  salary decimal(15,4) NOT NULL DEFAULT '0.0000',
  status enum('active','inactive','terminated') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_event (
  event_id int NOT NULL,
  code varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  `trigger` mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  action mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL,
  sort_order int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_extension (
  extension_id int NOT NULL,
  type varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(32) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_extension_install (
  extension_install_id int NOT NULL,
  extension_download_id int NOT NULL,
  filename varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_extension_path (
  extension_path_id int NOT NULL,
  extension_install_id int NOT NULL,
  path varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_feedback_history (
  history_id int NOT NULL,
  feedback_id int NOT NULL,
  user_id int NOT NULL,
  action enum('created','updated','assigned','responded','resolved','reopened','closed') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  comment text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  visibility enum('internal','customer','both') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'internal'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_feedback_message (
  message_id int NOT NULL,
  feedback_id int NOT NULL,
  sender_type enum('customer','employee','system') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  sender_id int NOT NULL COMMENT 'customer_id أو user_id حسب sender_type',
  message text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_internal tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل الرسالة داخلية فقط',
  attachment_path varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_feedback_template (
  template_id int NOT NULL,
  title varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  content text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  category enum('complaint','suggestion','inquiry','appreciation') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  status enum('active','inactive') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  tags varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_filter (
  filter_id int NOT NULL,
  filter_group_id int NOT NULL,
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_filter_description (
  filter_id int NOT NULL,
  language_id int NOT NULL,
  filter_group_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_filter_group (
  filter_group_id int NOT NULL,
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_filter_group_description (
  filter_group_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_financial_forecast (
  forecast_id int NOT NULL,
  forecast_name varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  forecast_type varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  period_start date NOT NULL,
  period_end date NOT NULL,
  forecast_value decimal(15,4) NOT NULL,
  actual_value decimal(15,4) DEFAULT NULL,
  variance decimal(15,4) DEFAULT NULL,
  variance_percentage decimal(5,2) DEFAULT NULL,
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_fixed_assets (
  asset_id int NOT NULL,
  asset_code varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  asset_type_id int NOT NULL,
  purchase_date date NOT NULL,
  purchase_value decimal(15,2) NOT NULL,
  current_value decimal(15,2) NOT NULL,
  depreciation_method varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  useful_life int NOT NULL,
  salvage_value decimal(15,2) NOT NULL,
  status enum('active','disposed','under_maintenance') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  notes text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_fixed_asset_history (
  history_id int NOT NULL,
  asset_id int NOT NULL,
  user_id int NOT NULL,
  action varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_geo_zone (
  geo_zone_id int NOT NULL,
  name varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  description varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_gift_card (
  gift_card_id int NOT NULL,
  code varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  from_name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  from_email varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  to_name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  to_email varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  message mediumtext COLLATE utf8mb4_general_ci,
  amount decimal(15,4) NOT NULL,
  status tinyint(1) NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_goods_receipt (
  goods_receipt_id int NOT NULL,
  po_id int NOT NULL,
  receipt_number varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  branch_id int NOT NULL,
  receipt_date date NOT NULL,
  status enum('pending','received','partially_received','cancelled') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  journal_id int NOT NULL DEFAULT '0',
  notes text COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL,
  updated_at datetime NOT NULL,
  invoice_number varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'رقم فاتورة المورد',
  invoice_date date DEFAULT NULL COMMENT 'تاريخ فاتورة المورد',
  invoice_amount decimal(15,4) DEFAULT NULL COMMENT 'قيمة فاتورة المورد',
  currency_id int DEFAULT NULL COMMENT 'عملة الفاتورة',
  exchange_rate decimal(15,6) DEFAULT NULL COMMENT 'سعر الصرف عند الاستلام',
  matching_status enum('pending','matched','partial','mismatch') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending' COMMENT 'حالة المطابقة مع الفاتورة وأمر الشراء',
  quality_check_required tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل يتطلب فحص جودة',
  quality_checked_by int DEFAULT NULL COMMENT 'من قام بفحص الجودة',
  quality_check_date datetime DEFAULT NULL COMMENT 'تاريخ فحص الجودة',
  quality_check_result text COLLATE utf8mb4_general_ci COMMENT 'نتيجة فحص الجودة'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_goods_receipt_item (
  receipt_item_id int NOT NULL,
  goods_receipt_id int NOT NULL,
  po_item_id int NOT NULL,
  product_id int NOT NULL,
  quantity_received decimal(15,4) NOT NULL,
  unit_id int NOT NULL,
  quality_result enum('pending','passed','failed','partial') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  remarks text COLLATE utf8mb4_general_ci,
  invoice_unit_price decimal(15,4) DEFAULT NULL COMMENT 'سعر الوحدة في الفاتورة',
  cost_difference decimal(15,4) DEFAULT NULL COMMENT 'فرق التكلفة عن أمر الشراء',
  is_cost_updated tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل تم تحديث التكلفة'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_governance_issue (
  issue_id int NOT NULL,
  issue_type enum('compliance','risk','legal','audit','other') COLLATE utf8mb4_general_ci NOT NULL,
  title varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci NOT NULL,
  priority enum('low','medium','high','critical') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'medium',
  status enum('open','in_progress','resolved','closed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'open',
  responsible_user_id int DEFAULT NULL,
  responsible_group_id int DEFAULT NULL,
  due_date date DEFAULT NULL,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  resolved_at datetime DEFAULT NULL,
  resolution_notes text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_governance_meeting (
  meeting_id int NOT NULL,
  meeting_type varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'مثلاً: مجلس إدارة، لجنة مراجعة، جمعية عمومية...',
  title varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'عنوان الاجتماع أو موضوعه',
  meeting_date datetime NOT NULL COMMENT 'موعد الاجتماع',
  location varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  agenda text COLLATE utf8mb4_general_ci COMMENT 'جدول الأعمال',
  decisions text COLLATE utf8mb4_general_ci COMMENT 'القرارات المتخذة في الاجتماع',
  added_by int DEFAULT NULL COMMENT 'user_id الذي سجّل المحضر',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_gpc_codes (
  gpc_id int NOT NULL,
  gpc_code int NOT NULL,
  title varchar(512) COLLATE utf8mb4_general_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_hitshippo_aramex_details_new (
  id int NOT NULL,
  order_id text COLLATE utf8mb4_general_ci NOT NULL,
  tracking_num text COLLATE utf8mb4_general_ci NOT NULL,
  shipping_label mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  invoice mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  return_label mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  return_invoice mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  one mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  two mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  three mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_hitshippo_aramex_pickup_details (
  id int NOT NULL,
  order_id text COLLATE utf8mb4_general_ci NOT NULL,
  status text COLLATE utf8mb4_general_ci NOT NULL,
  confirm_no mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  ready_time mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  pickup_date mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  one mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  two mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  three mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_hitshippo_fedex_details_new (
  id int NOT NULL,
  order_id text COLLATE utf8mb4_general_ci NOT NULL,
  tracking_num text COLLATE utf8mb4_general_ci NOT NULL,
  shipping_label mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  invoice mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  return_label mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  return_invoice mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  one mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  two mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  three mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_hitshippo_fedex_token (
  id int NOT NULL,
  token text COLLATE utf8mb4_general_ci NOT NULL,
  timestamp_created text COLLATE utf8mb4_general_ci NOT NULL,
  mode varchar(10) COLLATE utf8mb4_general_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_import_allocation (
  allocation_id int NOT NULL,
  shipment_id int NOT NULL,
  product_id int NOT NULL,
  allocated_amount decimal(15,4) NOT NULL,
  notes text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_import_charge (
  charge_id int NOT NULL,
  shipment_id int NOT NULL,
  charge_type varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  amount decimal(15,4) NOT NULL,
  currency varchar(3) COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'EGP',
  notes text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_import_shipment (
  shipment_id int NOT NULL,
  reference_number varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  origin_country varchar(3) COLLATE utf8mb4_general_ci DEFAULT NULL,
  arrival_port varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  shipment_date date NOT NULL,
  document_reference varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  notes text COLLATE utf8mb4_general_ci,
  status enum('in_progress','completed','cancelled') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'in_progress',
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_information (
  information_id int NOT NULL,
  bottom int NOT NULL DEFAULT '0',
  sort_order int NOT NULL DEFAULT '0',
  status tinyint(1) NOT NULL DEFAULT '1'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_information_description (
  information_id int NOT NULL,
  language_id int NOT NULL,
  title varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  description longtext COLLATE utf8mb4_general_ci NOT NULL,
  meta_title varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  meta_description varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  meta_keyword varchar(255) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_information_to_layout (
  information_id int NOT NULL,
  store_id int NOT NULL,
  layout_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_information_to_store (
  information_id int NOT NULL,
  store_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_installment_payment (
  payment_id int NOT NULL,
  schedule_id int NOT NULL,
  payment_date datetime NOT NULL,
  amount decimal(15,4) NOT NULL,
  payment_method enum('cash','bank_transfer','credit_card','cheque','online') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  payment_reference varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  received_by int DEFAULT NULL,
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  transaction_id varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  receipt_number varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  bank_account_id int DEFAULT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_installment_plan (
  plan_id int NOT NULL,
  order_id int NOT NULL,
  customer_id int NOT NULL,
  template_id int DEFAULT NULL,
  total_amount decimal(15,4) NOT NULL COMMENT 'المبلغ الإجمالي للخطة',
  down_payment decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'الدفعة المقدمة',
  remaining_amount decimal(15,4) NOT NULL COMMENT 'المبلغ المتبقي بعد الدفعة المقدمة',
  installment_amount decimal(15,4) NOT NULL COMMENT 'قيمة القسط الواحد',
  number_of_installments int NOT NULL,
  interest_rate decimal(5,2) NOT NULL DEFAULT '0.00',
  total_interest decimal(15,4) NOT NULL DEFAULT '0.0000',
  admin_fees decimal(15,4) NOT NULL DEFAULT '0.0000',
  total_with_interest decimal(15,4) NOT NULL COMMENT 'المبلغ الإجمالي شاملاً الفوائد والرسوم',
  installment_frequency enum('monthly','biweekly','weekly') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'monthly',
  start_date date NOT NULL,
  status enum('pending','active','completed','cancelled','defaulted') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  approved_by int DEFAULT NULL,
  approved_at datetime DEFAULT NULL,
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  grace_period_days int NOT NULL DEFAULT '0' COMMENT 'فترة سماح بالأيام',
  late_payment_fee decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'رسوم التأخير',
  late_payment_fee_percentage decimal(5,2) NOT NULL DEFAULT '0.00',
  guarantor_id int DEFAULT NULL COMMENT 'كفيل العميل إن وجد'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_installment_plan_template (
  template_id int NOT NULL,
  name varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  description text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  number_of_installments int NOT NULL,
  interest_rate decimal(5,2) NOT NULL DEFAULT '0.00' COMMENT 'نسبة الفائدة السنوية',
  admin_fees decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'رسوم إدارية ثابتة',
  admin_fees_percentage decimal(5,2) NOT NULL DEFAULT '0.00' COMMENT 'نسبة الرسوم الإدارية',
  down_payment_percentage decimal(5,2) NOT NULL DEFAULT '0.00' COMMENT 'نسبة الدفعة المقدمة',
  minimum_order_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  maximum_order_amount decimal(15,4) DEFAULT NULL,
  is_active tinyint(1) NOT NULL DEFAULT '1',
  requires_approval tinyint(1) NOT NULL DEFAULT '0',
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_installment_reminder (
  reminder_id int NOT NULL,
  schedule_id int NOT NULL,
  reminder_type enum('before_due','on_due','overdue','final_notice') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  channel enum('email','sms','whatsapp','system','call') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  scheduled_date datetime NOT NULL,
  sent_date datetime DEFAULT NULL,
  status enum('pending','sent','failed','cancelled') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  message text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_installment_schedule (
  schedule_id int NOT NULL,
  plan_id int NOT NULL,
  installment_number int NOT NULL,
  due_date date NOT NULL,
  amount decimal(15,4) NOT NULL,
  principal_amount decimal(15,4) NOT NULL COMMENT 'مبلغ أصل الدين',
  interest_amount decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'مبلغ الفائدة',
  status enum('upcoming','due','paid','partial','late','defaulted') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'upcoming',
  payment_date datetime DEFAULT NULL,
  payment_amount decimal(15,4) DEFAULT NULL,
  payment_method varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  payment_reference varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  late_fee_applied decimal(15,4) NOT NULL DEFAULT '0.0000',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_internal_attachment (
  attachment_id int NOT NULL,
  message_id int NOT NULL,
  file_name varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  file_path varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  file_size int NOT NULL,
  file_type varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  uploaded_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  thumbnail_path varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'مسار الصورة المصغرة إن وجدت'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_internal_audit (
  audit_id int NOT NULL,
  audit_subject varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'موضوع التدقيق',
  audit_type varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'نوع التدقيق: مالي, تشغيلي.. الخ',
  description text COLLATE utf8mb4_general_ci COMMENT 'نطاق أو تفاصيل التدقيق',
  auditor_user_id int NOT NULL COMMENT 'يتعيّن تلقائياً حسب المستخدم الحالي',
  scheduled_date date NOT NULL COMMENT 'تاريخ بدء التدقيق',
  completion_date date DEFAULT NULL COMMENT 'تاريخ إكمال التدقيق',
  findings text COLLATE utf8mb4_general_ci COMMENT 'النتائج',
  recommendations text COLLATE utf8mb4_general_ci COMMENT 'التوصيات',
  status enum('scheduled','in_progress','completed','cancelled') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'scheduled',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_internal_control (
  control_id int NOT NULL,
  control_name varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'اسم الإجراء/السياسة',
  description text COLLATE utf8mb4_general_ci COMMENT 'تفاصيل أو شرح للإجراء',
  responsible_group_id int NOT NULL DEFAULT '0' COMMENT 'رقم مجموعة المستخدم المسؤولة (إدارة معينة)',
  effective_date date NOT NULL COMMENT 'تاريخ سريان السياسة',
  review_date date DEFAULT NULL COMMENT 'تاريخ آخر مراجعة',
  status enum('active','obsolete') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active' COMMENT 'حالة الإجراء',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_internal_conversation (
  conversation_id int NOT NULL,
  title varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  type enum('private','group','department') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'private',
  creator_id int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  status enum('active','archived') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  associated_module varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'المودل المرتبط مثل order, purchase, etc',
  reference_id int DEFAULT NULL COMMENT 'المعرف المرتبط مثل order_id'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_internal_message (
  message_id int NOT NULL,
  conversation_id int NOT NULL,
  sender_id int NOT NULL,
  message_text text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  sent_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  edited_at datetime DEFAULT NULL,
  is_system_message tinyint(1) NOT NULL DEFAULT '0',
  message_type enum('text','file','link','task','workflow','approval') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'text',
  reference_module varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'المودل المرتبط مثل order, document, meeting',
  reference_id int DEFAULT NULL COMMENT 'المعرف المرتبط بالمودل',
  parent_message_id int DEFAULT NULL,
  mentions text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci COMMENT 'قائمة المستخدمين المشار إليهم'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_internal_participant (
  participant_id int NOT NULL,
  conversation_id int NOT NULL,
  user_id int NOT NULL,
  joined_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  left_at datetime DEFAULT NULL,
  role enum('member','admin') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'member',
  last_read_message_id int DEFAULT NULL,
  notification_settings enum('all','mentions','none') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'all'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_abc_analysis (
  abc_id int NOT NULL,
  product_id int NOT NULL,
  branch_id int NOT NULL,
  period_start date NOT NULL,
  period_end date NOT NULL,
  value_contribution decimal(15,4) NOT NULL,
  percentage_of_total decimal(5,2) NOT NULL,
  cumulative_percentage decimal(5,2) NOT NULL,
  abc_class char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  analysis_date datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_accounting_reconciliation (
  reconciliation_id int NOT NULL,
  period_start_date date NOT NULL,
  period_end_date date NOT NULL,
  branch_id int NOT NULL,
  status enum('draft','in_progress','completed','approved') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'draft',
  total_system_value decimal(15,4) NOT NULL DEFAULT '0.0000',
  total_accounting_value decimal(15,4) NOT NULL DEFAULT '0.0000',
  difference_value decimal(15,4) NOT NULL DEFAULT '0.0000',
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  completed_at datetime DEFAULT NULL,
  approved_by int DEFAULT NULL,
  notes text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_accounting_reconciliation_item (
  item_id int NOT NULL,
  reconciliation_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  system_quantity decimal(15,4) NOT NULL DEFAULT '0.0000',
  system_value decimal(15,4) NOT NULL DEFAULT '0.0000',
  accounting_value decimal(15,4) NOT NULL DEFAULT '0.0000',
  difference_value decimal(15,4) NOT NULL DEFAULT '0.0000',
  adjustment_journal_id int DEFAULT NULL,
  is_adjusted tinyint(1) NOT NULL DEFAULT '0',
  notes text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_account_mapping (
  mapping_id int NOT NULL,
  branch_id int NOT NULL COMMENT 'الفرع أو المستودع',
  product_category_id int DEFAULT NULL COMMENT 'يمكن ربط فئة محددة، أو NULL للكل',
  inventory_account_code bigint NOT NULL COMMENT 'حساب المخزون',
  cogs_account_code bigint NOT NULL COMMENT 'حساب تكلفة المبيعات',
  purchase_account_code bigint NOT NULL COMMENT 'حساب المشتريات (مؤقت)',
  inventory_adjustment_account_code bigint DEFAULT NULL COMMENT 'حساب تسويات المخزون',
  price_variance_account_code bigint DEFAULT NULL COMMENT 'حساب فروق أسعار المشتريات',
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_alert (
  alert_id int NOT NULL,
  product_id int NOT NULL,
  branch_id int NOT NULL,
  alert_type enum('minimum','maximum','expired','slow_moving','damaged') COLLATE utf8mb4_general_ci NOT NULL,
  quantity decimal(15,4) NOT NULL,
  threshold decimal(15,4) NOT NULL,
  status enum('active','acknowledged','resolved','ignored') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  days_no_movement int DEFAULT NULL,
  last_movement_date date DEFAULT NULL,
  recommended_action varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  acknowledged_by int DEFAULT NULL,
  acknowledged_at datetime DEFAULT NULL,
  resolved_at datetime DEFAULT NULL,
  notes text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_cost_history (
  history_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  old_cost decimal(15,4) NOT NULL DEFAULT '0.0000',
  new_cost decimal(15,4) NOT NULL DEFAULT '0.0000',
  change_reason varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  notes mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  user_id int NOT NULL DEFAULT '0',
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_cost_update (
  update_id int NOT NULL,
  product_id int NOT NULL,
  branch_id int NOT NULL,
  old_cost decimal(15,4) NOT NULL,
  new_cost decimal(15,4) NOT NULL,
  update_date datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  source_type enum('purchase','adjustment','import') COLLATE utf8mb4_general_ci NOT NULL,
  source_id int NOT NULL COMMENT 'معرف المصدر',
  notes text COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  journal_id int DEFAULT NULL COMMENT 'معرف القيد المحاسبي'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_count (
  count_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  branch_id int NOT NULL,
  system_quantity decimal(15,4) NOT NULL DEFAULT '0.0000',
  counted_quantity decimal(15,4) NOT NULL DEFAULT '0.0000',
  quantity_difference decimal(15,4) NOT NULL DEFAULT '0.0000',
  counted_by int NOT NULL DEFAULT '0',
  count_date datetime NOT NULL,
  notes mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  status varchar(20) COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  applied_by int DEFAULT NULL,
  applied_date datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_reservation (
  reservation_id int NOT NULL,
  product_id int NOT NULL,
  branch_id int NOT NULL,
  unit_id int NOT NULL,
  quantity decimal(15,4) NOT NULL,
  source_type varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'order, quotation, etc',
  source_id int NOT NULL,
  reservation_date datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  expiry_date datetime DEFAULT NULL,
  status varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  created_by int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_sheet (
  sheet_id int NOT NULL,
  branch_id int NOT NULL,
  sheet_date datetime NOT NULL,
  status varchar(20) COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'draft',
  created_by int NOT NULL DEFAULT '0',
  created_at datetime NOT NULL,
  completed_by int DEFAULT NULL,
  completed_at datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_sheet_item (
  sheet_item_id int NOT NULL,
  sheet_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  system_quantity decimal(15,4) NOT NULL DEFAULT '0.0000',
  counted_quantity decimal(15,4) NOT NULL DEFAULT '0.0000',
  notes mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  count_id int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_transfer (
  transfer_id int NOT NULL,
  transfer_number varchar(30) COLLATE utf8mb4_general_ci NOT NULL,
  source_branch_id int NOT NULL,
  destination_branch_id int NOT NULL,
  transfer_date date NOT NULL,
  notes mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  status varchar(20) COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  created_by int NOT NULL DEFAULT '0',
  created_at datetime NOT NULL,
  completed_by int DEFAULT NULL,
  completed_at datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_transfer_item (
  item_id int NOT NULL,
  transfer_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  quantity decimal(15,4) NOT NULL DEFAULT '0.0000'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_turnover (
  analysis_id int NOT NULL,
  product_id int NOT NULL,
  branch_id int NOT NULL,
  period_start date NOT NULL,
  period_end date NOT NULL,
  beginning_inventory decimal(15,4) NOT NULL,
  ending_inventory decimal(15,4) NOT NULL,
  average_inventory decimal(15,4) NOT NULL,
  cost_of_goods_sold decimal(15,4) NOT NULL,
  turnover_ratio decimal(10,2) NOT NULL,
  days_on_hand int NOT NULL,
  analysis_date datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_inventory_valuation (
  valuation_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  branch_id int NOT NULL DEFAULT '0',
  valuation_date date NOT NULL,
  average_cost decimal(15,4) NOT NULL DEFAULT '0.0000',
  quantity decimal(15,4) NOT NULL DEFAULT '0.0000',
  total_value decimal(15,4) NOT NULL DEFAULT '0.0000',
  date_added datetime NOT NULL,
  transaction_reference_id int NOT NULL DEFAULT '0',
  transaction_type varchar(20) COLLATE utf8mb4_general_ci NOT NULL,
  previous_quantity decimal(15,4) NOT NULL DEFAULT '0.0000',
  previous_cost decimal(15,4) NOT NULL DEFAULT '0.0000',
  movement_quantity decimal(15,4) NOT NULL DEFAULT '0.0000',
  movement_cost decimal(15,4) NOT NULL DEFAULT '0.0000'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_invoices (
  invoice_id int NOT NULL,
  customer_id int NOT NULL,
  order_id int NOT NULL,
  issuer_type varchar(2) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_id varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_name varchar(200) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_country varchar(3) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_governate varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_region_city varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_street varchar(200) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_building_number varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_postal_code varchar(20) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_floor varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_room varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_landmark varchar(200) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_additional_info varchar(500) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_type varchar(2) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_id varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_name varchar(200) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_country varchar(3) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_governate varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_region_city varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_street varchar(200) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_building_number varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_postal_code varchar(20) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_floor varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_room varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_landmark varchar(200) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_additional_info varchar(500) COLLATE utf8mb4_general_ci DEFAULT NULL,
  document_type varchar(5) COLLATE utf8mb4_general_ci DEFAULT NULL,
  document_version varchar(10) COLLATE utf8mb4_general_ci DEFAULT NULL,
  date_time_issued datetime DEFAULT NULL,
  taxpayer_activity_code varchar(10) COLLATE utf8mb4_general_ci DEFAULT NULL,
  internal_id varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  purchase_order_reference varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  purchase_order_description varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  sales_order_reference varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  sales_order_description varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  proforma_invoice_number varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  total_sales_amount decimal(13,5) DEFAULT NULL,
  total_discount_amount decimal(13,5) DEFAULT NULL,
  net_amount decimal(13,5) DEFAULT NULL,
  total_amount decimal(13,5) DEFAULT NULL,
  extra_discount_amount decimal(13,5) DEFAULT NULL,
  total_items_discount_amount decimal(13,5) DEFAULT NULL,
  submission_uuid varchar(36) COLLATE utf8mb4_general_ci DEFAULT NULL,
  status enum('pending','submitted','accepted','rejected') COLLATE utf8mb4_general_ci DEFAULT 'pending',
  rejection_reason text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_journals (
  journal_id int NOT NULL,
  refnum varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  thedate date NOT NULL,
  description mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  added_by varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  last_edit_by varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  audit_by varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  is_cancelled tinyint(1) NOT NULL DEFAULT '0',
  cancelled_date datetime DEFAULT NULL,
  cancelled_by varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  audited tinyint(1) NOT NULL DEFAULT '0',
  audit_date datetime DEFAULT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  entrytype tinyint(1) NOT NULL DEFAULT '2' COMMENT '1 يدوي\r\n2 آلي'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_journal_attachments (
  attachment_id int NOT NULL,
  journal_id int NOT NULL,
  file_name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  file_path varchar(255) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_journal_entries (
  entry_id int NOT NULL,
  journal_id int NOT NULL,
  account_code bigint NOT NULL,
  is_debit tinyint(1) NOT NULL,
  amount decimal(15,4) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_language (
  language_id int NOT NULL,
  name varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(5) COLLATE utf8mb4_general_ci NOT NULL,
  locale varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  image varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  directory varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  sort_order int NOT NULL DEFAULT '0',
  status tinyint(1) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_layout (
  layout_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_layout_module (
  layout_module_id int NOT NULL,
  layout_id int NOT NULL,
  code varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  position varchar(14) COLLATE utf8mb4_general_ci NOT NULL,
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_layout_route (
  layout_route_id int NOT NULL,
  layout_id int NOT NULL,
  store_id int NOT NULL,
  route varchar(64) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_leave_request (
  leave_request_id int NOT NULL,
  user_id int NOT NULL,
  leave_type_id int NOT NULL,
  start_date date NOT NULL,
  end_date date NOT NULL,
  status enum('pending','approved','rejected','cancelled') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  reason text COLLATE utf8mb4_general_ci,
  approved_by int DEFAULT NULL,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_leave_type (
  leave_type_id int NOT NULL,
  name varchar(100) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  status tinyint(1) NOT NULL DEFAULT '1',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_legal_contract (
  contract_id int NOT NULL,
  contract_type varchar(50) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'نوع العقد: تأجير فرع، توريد، ...',
  title varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'عنوان العقد',
  party_id int DEFAULT NULL COMMENT 'ربط مع طرف خارجي (مورد، عميل...) أو فرع',
  start_date date NOT NULL,
  end_date date DEFAULT NULL COMMENT 'تاريخ الانتهاء أو null إن كان مفتوح المدة',
  status enum('active','expired','terminated','draft') COLLATE utf8mb4_general_ci DEFAULT 'draft',
  value decimal(15,2) DEFAULT '0.00' COMMENT 'قيمة العقد المالية إن وجدت',
  description text COLLATE utf8mb4_general_ci COMMENT 'وصف أو شروط العقد',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_length_class (
  length_class_id int NOT NULL,
  value decimal(15,8) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_length_class_description (
  length_class_id int NOT NULL,
  language_id int NOT NULL,
  title varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  unit varchar(4) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_location (
  location_id int NOT NULL,
  name varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  address mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  telephone varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  fax varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  geocode varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  image varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  open mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  comment mediumtext COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_manufacturer (
  manufacturer_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  image varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_manufacturer_to_store (
  manufacturer_id int NOT NULL,
  store_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_marketing (
  marketing_id int NOT NULL,
  name varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  description mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  clicks int NOT NULL DEFAULT '0',
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_meeting_attendees (
  attendee_id int NOT NULL,
  meeting_id int NOT NULL,
  user_id int DEFAULT NULL COMMENT 'إذا كان الحاضر موظف بالشركة',
  external_name varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'إذا كان الحاضر من خارج الشركة',
  role_in_meeting varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'عضو مجلس إدارة، مستشار، ...',
  presence_status enum('attended','excused','absent') COLLATE utf8mb4_general_ci DEFAULT 'attended'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_modification (
  modification_id int NOT NULL,
  extension_install_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  author varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  version varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  link varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  xml longtext COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_module (
  module_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  setting mediumtext COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_notices (
  notice_id int NOT NULL,
  invoice_id int NOT NULL,
  type enum('credit','debit') COLLATE utf8mb4_general_ci NOT NULL,
  issuer_type varchar(2) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_id varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  issuer_name varchar(200) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_type varchar(2) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_id varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  receiver_name varchar(200) COLLATE utf8mb4_general_ci DEFAULT NULL,
  document_type varchar(5) COLLATE utf8mb4_general_ci DEFAULT NULL,
  document_version varchar(10) COLLATE utf8mb4_general_ci DEFAULT NULL,
  date_time_issued datetime DEFAULT NULL,
  taxpayer_activity_code varchar(10) COLLATE utf8mb4_general_ci DEFAULT NULL,
  internal_id varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  `references` text COLLATE utf8mb4_general_ci,
  total_amount decimal(13,5) DEFAULT NULL,
  total_sales_amount decimal(13,5) DEFAULT NULL,
  total_discount_amount decimal(13,5) DEFAULT NULL,
  net_amount decimal(13,5) DEFAULT NULL,
  submission_uuid varchar(36) COLLATE utf8mb4_general_ci DEFAULT NULL,
  status enum('pending','submitted','accepted','rejected') COLLATE utf8mb4_general_ci DEFAULT 'pending',
  rejection_reason text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_notification_user (
  notification_user_id int NOT NULL,
  notification_id int NOT NULL,
  user_id int NOT NULL,
  is_read tinyint(1) NOT NULL DEFAULT '0',
  read_at datetime DEFAULT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_option (
  option_id int NOT NULL,
  type varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_option_description (
  option_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(128) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_option_value (
  option_value_id int NOT NULL,
  option_id int NOT NULL,
  image varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_option_value_description (
  option_value_id int NOT NULL,
  language_id int NOT NULL,
  option_id int NOT NULL,
  name varchar(128) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_order (
  order_id int NOT NULL,
  journal_id int NOT NULL DEFAULT '0',
  invoice_no int NOT NULL DEFAULT '0',
  invoice_prefix varchar(26) COLLATE utf8mb4_general_ci NOT NULL,
  store_id int NOT NULL DEFAULT '0',
  store_name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  store_url varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  customer_id int NOT NULL DEFAULT '0',
  customer_group_id int NOT NULL DEFAULT '0',
  firstname varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  lastname varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  email varchar(96) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  telephone varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  fax varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  custom_field mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  payment_firstname varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  payment_lastname varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  payment_company varchar(60) COLLATE utf8mb4_general_ci NOT NULL,
  payment_address_1 varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  payment_address_2 varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  payment_city varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  payment_postcode varchar(10) COLLATE utf8mb4_general_ci NOT NULL,
  payment_country varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  payment_country_id int NOT NULL,
  payment_zone varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  payment_zone_id int NOT NULL,
  payment_address_format mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  payment_custom_field mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  payment_method varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  payment_code varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  shipping_firstname varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  shipping_lastname varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  shipping_company varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  shipping_address_1 varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  shipping_address_2 varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  shipping_city varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  shipping_postcode varchar(10) COLLATE utf8mb4_general_ci NOT NULL,
  shipping_country varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  shipping_country_id int NOT NULL,
  shipping_zone varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  shipping_zone_id int NOT NULL,
  shipping_address_format mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  shipping_custom_field mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  shipping_method varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  shipping_code varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  comment mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  total decimal(15,4) NOT NULL DEFAULT '0.0000',
  order_status_id int NOT NULL DEFAULT '0',
  affiliate_id int NOT NULL,
  commission decimal(15,4) NOT NULL,
  marketing_id int NOT NULL,
  tracking varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  language_id int NOT NULL,
  currency_id int NOT NULL,
  currency_code varchar(3) COLLATE utf8mb4_general_ci NOT NULL,
  currency_value decimal(15,8) NOT NULL DEFAULT '1.00000000',
  ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  forwarded_ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  user_agent varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  accept_language varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL,
  order_posuser_id int NOT NULL,
  order_posuser_name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  shift_id int NOT NULL DEFAULT '0',
  rin_customer varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  qr_code varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  uuid varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  longId varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  hashKey varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  submissionId varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  fbcapidyad_ordflag tinyint(1) DEFAULT '0',
  confirmation_status enum('Canceled','Pending','Confirmed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'Pending',
  confirmation_token varchar(64) COLLATE utf8mb4_general_ci DEFAULT NULL,
  installment_plan_id int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_order_cogs (
  order_cogs_id int NOT NULL,
  order_id int NOT NULL,
  total_cogs decimal(15,4) NOT NULL DEFAULT '0.0000',
  journal_id int DEFAULT NULL COMMENT 'معرف القيد المحاسبي',
  calculation_method varchar(20) COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'weighted_average' COMMENT 'طريقة حساب التكلفة',
  inventory_account_code bigint DEFAULT NULL COMMENT 'حساب المخزون المستخدم',
  cogs_account_code bigint DEFAULT NULL COMMENT 'حساب تكلفة المبيعات المستخدم',
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_order_history (
  order_history_id int NOT NULL,
  order_id int NOT NULL,
  order_status_id int NOT NULL,
  notify tinyint(1) NOT NULL DEFAULT '0',
  comment mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_order_option (
  order_option_id int NOT NULL,
  order_id int NOT NULL,
  order_product_id int NOT NULL,
  product_option_id int NOT NULL,
  product_option_value_id int NOT NULL DEFAULT '0',
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  value mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  type varchar(32) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_order_product (
  order_product_id int NOT NULL,
  order_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL DEFAULT '37',
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  model varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  quantity int NOT NULL,
  price decimal(15,4) NOT NULL DEFAULT '0.0000',
  total decimal(15,4) NOT NULL DEFAULT '0.0000',
  tax decimal(15,4) NOT NULL DEFAULT '0.0000',
  reward int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_order_shipment (
  order_shipment_id int NOT NULL,
  order_id int NOT NULL,
  date_added datetime NOT NULL,
  shipping_courier_id varchar(255) COLLATE utf8mb4_general_ci NOT NULL DEFAULT '',
  tracking_number varchar(255) COLLATE utf8mb4_general_ci NOT NULL DEFAULT ''
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_order_shipment_history (
  history_id int NOT NULL,
  order_shipment_id int NOT NULL,
  status varchar(50) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'مثال: تم الاستلام من الفرع، في الطريق، إلخ',
  location varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'موقع الشحنة أو ملاحظات',
  updated_by int NOT NULL COMMENT 'user_id الموظف الذي حدّث الحالة',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_order_status (
  order_status_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(32) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_order_total (
  order_total_id int NOT NULL,
  order_id int NOT NULL,
  code varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  title varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  value decimal(15,4) NOT NULL DEFAULT '0.0000',
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_order_voucher (
  order_voucher_id int NOT NULL,
  order_id int NOT NULL,
  voucher_id int NOT NULL,
  description varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(10) COLLATE utf8mb4_general_ci NOT NULL,
  from_name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  from_email varchar(96) COLLATE utf8mb4_general_ci NOT NULL,
  to_name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  to_email varchar(96) COLLATE utf8mb4_general_ci NOT NULL,
  voucher_theme_id int NOT NULL,
  message mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  amount decimal(15,4) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_paymentlinks (
  id int NOT NULL,
  order_id int NOT NULL,
  paymentlink mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  order_desc mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  order_total decimal(15,4) NOT NULL DEFAULT '0.0000',
  email varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  phone varchar(20) COLLATE utf8mb4_general_ci DEFAULT NULL,
  order_currency varchar(3) COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'EGP',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_payment_gateway (
  gateway_id int NOT NULL,
  name varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  description text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  status enum('active','inactive','testing') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'inactive',
  supported_methods varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'طرق الدفع المدعومة مفصولة بفواصل',
  currencies varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'العملات المدعومة مفصولة بفواصل',
  logo varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  sort_order int NOT NULL DEFAULT '0',
  supports_refunds tinyint(1) NOT NULL DEFAULT '0',
  supports_recurring tinyint(1) NOT NULL DEFAULT '0',
  fixed_fee decimal(15,4) NOT NULL DEFAULT '0.0000',
  percentage_fee decimal(5,2) NOT NULL DEFAULT '0.00',
  minimum_fee decimal(15,4) NOT NULL DEFAULT '0.0000',
  support_contact varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_payment_gateway_config (
  config_id int NOT NULL,
  gateway_id int NOT NULL,
  `key` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  value text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  is_sensitive tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل البيانات حساسة (مثل API keys)',
  environment enum('live','test','both') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'both',
  last_updated datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  updated_by int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_payment_invoice (
  payment_invoice_id int NOT NULL,
  payment_id int NOT NULL,
  invoice_id int NOT NULL,
  amount_paid decimal(15,4) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_payment_settlement (
  settlement_id int NOT NULL,
  gateway_id int NOT NULL,
  settlement_date date NOT NULL,
  settlement_reference varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  amount decimal(15,4) NOT NULL,
  fee_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  net_amount decimal(15,4) NOT NULL,
  currency varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'EGP',
  status enum('pending','reconciled','disputed') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  bank_account_id int DEFAULT NULL COMMENT 'الحساب البنكي المحول إليه',
  bank_transaction_id int DEFAULT NULL COMMENT 'معرف المعاملة البنكية',
  transaction_count int NOT NULL DEFAULT '0' COMMENT 'عدد المعاملات في التسوية',
  settlement_file varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'ملف التسوية إن وجد',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  reconciled_by int DEFAULT NULL,
  reconciled_at datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_payment_settlement_transaction (
  settlement_transaction_id int NOT NULL,
  settlement_id int NOT NULL,
  transaction_id int NOT NULL,
  status enum('matched','unmatched','disputed') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'matched',
  discrepancy_amount decimal(15,4) DEFAULT NULL COMMENT 'قيمة التباين إن وجد',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_payment_transaction (
  transaction_id int NOT NULL,
  gateway_id int NOT NULL,
  gateway_transaction_id varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'معرف المعاملة لدى البوابة',
  order_id int DEFAULT NULL,
  installment_payment_id int DEFAULT NULL,
  customer_id int NOT NULL,
  amount decimal(15,4) NOT NULL,
  currency varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'EGP',
  fee_amount decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'رسوم البوابة',
  net_amount decimal(15,4) NOT NULL COMMENT 'المبلغ الصافي = المبلغ - الرسوم',
  transaction_type enum('payment','refund','authorization','capture','void') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  payment_method varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'طريقة الدفع المستخدمة',
  status enum('pending','completed','failed','refunded','partial_refund','voided') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  error_code varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  error_message text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  request_data mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci COMMENT 'بيانات الطلب المرسلة للبوابة',
  response_data mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci COMMENT 'رد البوابة',
  ip_address varchar(45) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  user_agent varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  reference_transaction_id int DEFAULT NULL COMMENT 'في حالة الاسترداد أو التقاط المعاملة المرجعية',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  settlement_status enum('pending','settled','failed') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  settlement_date date DEFAULT NULL,
  bank_transfer_id int DEFAULT NULL COMMENT 'المعرف المرجعي للتحويل البنكي'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_payroll_entry (
  payroll_entry_id int NOT NULL,
  payroll_period_id int NOT NULL,
  user_id int NOT NULL,
  base_salary decimal(15,4) NOT NULL DEFAULT '0.0000',
  allowances decimal(15,4) NOT NULL DEFAULT '0.0000',
  deductions decimal(15,4) NOT NULL DEFAULT '0.0000',
  net_salary decimal(15,4) NOT NULL DEFAULT '0.0000',
  payment_status enum('pending','paid') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  payment_date datetime DEFAULT NULL,
  notes text COLLATE utf8mb4_general_ci,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_payroll_period (
  payroll_period_id int NOT NULL,
  period_name varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  start_date date NOT NULL,
  end_date date NOT NULL,
  status enum('open','closed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'open',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_closed datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_performance_criteria (
  criteria_id int NOT NULL,
  name varchar(100) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  status tinyint(1) NOT NULL DEFAULT '1',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_performance_review (
  review_id int NOT NULL,
  user_id int NOT NULL,
  review_date date NOT NULL,
  reviewer_id int NOT NULL,
  overall_score decimal(5,2) NOT NULL DEFAULT '0.00',
  comments text COLLATE utf8mb4_general_ci,
  status enum('pending','completed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_performance_review_criteria (
  review_criteria_id int NOT NULL,
  review_id int NOT NULL,
  criteria_id int NOT NULL,
  score decimal(5,2) NOT NULL DEFAULT '0.00',
  comments text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_permission (
  permission_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  `key` varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  type enum('access','modify','other') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'other',
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_pos_cash_handover (
  handover_id int NOT NULL,
  shift_id int NOT NULL,
  from_user_id int NOT NULL,
  to_user_id int NOT NULL,
  amount decimal(15,4) NOT NULL,
  handover_time datetime NOT NULL,
  notes mediumtext COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_pos_shift (
  shift_id int NOT NULL,
  user_id int NOT NULL,
  branch_id int NOT NULL,
  terminal_id int NOT NULL,
  start_time datetime NOT NULL,
  end_time datetime DEFAULT NULL,
  starting_cash decimal(15,4) NOT NULL DEFAULT '0.0000',
  ending_cash decimal(15,4) DEFAULT NULL,
  expected_cash decimal(15,4) DEFAULT NULL,
  cash_difference decimal(15,4) DEFAULT NULL,
  status enum('active','closed','balanced') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  notes mediumtext COLLATE utf8mb4_general_ci,
  total_sales decimal(15,4) NOT NULL DEFAULT '0.0000',
  total_cogs decimal(15,4) NOT NULL DEFAULT '0.0000',
  last_order_id int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_pos_terminal (
  terminal_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  branch_id int NOT NULL,
  status tinyint(1) NOT NULL DEFAULT '1',
  printer_type varchar(32) COLLATE utf8mb4_general_ci DEFAULT NULL,
  printer_name varchar(64) COLLATE utf8mb4_general_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_pos_transaction (
  transaction_id int NOT NULL,
  shift_id int NOT NULL,
  order_id int DEFAULT NULL,
  type enum('sale','cash_in','cash_out','refund','void','drop') COLLATE utf8mb4_general_ci NOT NULL,
  payment_method varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  amount decimal(15,4) NOT NULL,
  reference varchar(64) COLLATE utf8mb4_general_ci DEFAULT NULL,
  notes mediumtext COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product (
  product_id int NOT NULL,
  model varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  type enum('product','consu','service') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'product',
  sku varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  upc varchar(12) COLLATE utf8mb4_general_ci NOT NULL,
  ean varchar(14) COLLATE utf8mb4_general_ci NOT NULL,
  jan varchar(13) COLLATE utf8mb4_general_ci NOT NULL,
  isbn varchar(17) COLLATE utf8mb4_general_ci NOT NULL,
  mpn varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  location varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  quantity int NOT NULL DEFAULT '0',
  average_cost decimal(15,4) DEFAULT '0.0000',
  stock_status_id int NOT NULL,
  image varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  manufacturer_id int NOT NULL,
  shipping tinyint(1) NOT NULL DEFAULT '1',
  price decimal(15,4) NOT NULL DEFAULT '0.0000',
  points int NOT NULL DEFAULT '0',
  tax_class_id int NOT NULL,
  date_available date NOT NULL DEFAULT '1970-01-01',
  weight decimal(15,8) NOT NULL DEFAULT '0.00000000',
  weight_class_id int NOT NULL DEFAULT '0',
  length decimal(15,8) NOT NULL DEFAULT '0.00000000',
  width decimal(15,8) NOT NULL DEFAULT '0.00000000',
  height decimal(15,8) NOT NULL DEFAULT '0.00000000',
  length_class_id int NOT NULL DEFAULT '0',
  subtract tinyint(1) NOT NULL DEFAULT '1',
  minimum int NOT NULL DEFAULT '1',
  track_expiry tinyint(1) NOT NULL DEFAULT '0',
  expiry_alert_days int DEFAULT NULL,
  track_batch tinyint(1) NOT NULL DEFAULT '0',
  sort_order int NOT NULL DEFAULT '0',
  status tinyint(1) NOT NULL DEFAULT '0',
  viewed int NOT NULL DEFAULT '0',
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_attribute (
  product_id int NOT NULL,
  attribute_id int NOT NULL,
  language_id int NOT NULL,
  text mediumtext COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_barcode (
  product_barcode_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  product_option_id int DEFAULT NULL,
  product_option_value_id int DEFAULT NULL,
  barcode varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  type varchar(64) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_batch (
  batch_id int NOT NULL,
  product_id int NOT NULL,
  branch_id int NOT NULL,
  batch_number varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  manufacturing_date date DEFAULT NULL,
  expiry_date date NOT NULL,
  initial_quantity decimal(15,4) NOT NULL,
  remaining_quantity decimal(15,4) NOT NULL,
  cost decimal(15,4) NOT NULL,
  status varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_bundle (
  bundle_id int NOT NULL,
  product_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  discount_type enum('percentage','fixed','product') COLLATE utf8mb4_general_ci NOT NULL,
  discount_value decimal(15,4) NOT NULL DEFAULT '0.0000',
  status tinyint(1) NOT NULL DEFAULT '1'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_bundle_item (
  bundle_item_id int NOT NULL,
  bundle_id int NOT NULL,
  product_id int NOT NULL,
  quantity int NOT NULL DEFAULT '1',
  unit_id int NOT NULL,
  is_free tinyint(1) NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_description (
  product_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  tag mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  meta_title varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  meta_description varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  meta_keyword varchar(255) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_dynamic_pricing (
  product_id int NOT NULL,
  rule_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_egs (
  id int NOT NULL,
  product_id int NOT NULL,
  egs_code varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  gpc_code varchar(30) COLLATE utf8mb4_general_ci DEFAULT NULL,
  eta_status varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_filter (
  product_id int NOT NULL,
  filter_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_image (
  product_image_id int NOT NULL,
  product_id int NOT NULL,
  image varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  sort_order int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_inventory (
  product_inventory_id int NOT NULL,
  product_id int NOT NULL,
  branch_id int NOT NULL,
  unit_id int NOT NULL,
  quantity decimal(15,4) NOT NULL DEFAULT '0.0000',
  quantity_available decimal(15,4) NOT NULL DEFAULT '0.0000',
  is_consignment tinyint(1) NOT NULL DEFAULT '0',
  consignment_supplier_id int DEFAULT NULL,
  average_cost decimal(15,4) NOT NULL DEFAULT '0.0000'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_inventory_history (
  history_id int NOT NULL,
  product_id int NOT NULL,
  branch_id int NOT NULL,
  unit_id int NOT NULL,
  transaction_date datetime NOT NULL,
  transaction_type varchar(20) COLLATE utf8mb4_general_ci NOT NULL,
  reference_id int NOT NULL DEFAULT '0',
  reference_type varchar(30) COLLATE utf8mb4_general_ci NOT NULL DEFAULT '',
  quantity_before decimal(15,4) NOT NULL DEFAULT '0.0000',
  quantity_after decimal(15,4) NOT NULL DEFAULT '0.0000',
  quantity_change decimal(15,4) NOT NULL DEFAULT '0.0000',
  cost_before decimal(15,4) NOT NULL DEFAULT '0.0000',
  cost_after decimal(15,4) NOT NULL DEFAULT '0.0000',
  created_by int NOT NULL DEFAULT '0',
  created_at datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_movement (
  product_movement_id int NOT NULL,
  journal_id int NOT NULL DEFAULT '0',
  product_id int NOT NULL,
  type enum('purchase','sale','adjustment','transfer','consignment','import','receipt') COLLATE utf8mb4_general_ci NOT NULL,
  movement_reference_type varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  movement_reference_id int DEFAULT NULL,
  source_document_type varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'نوع المستند المصدر (فاتورة، أمر شراء، إلخ)',
  source_document_id int DEFAULT NULL COMMENT 'معرف المستند المصدر',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  quantity decimal(15,4) NOT NULL,
  unit_cost decimal(15,4) DEFAULT NULL,
  unit_id int NOT NULL,
  branch_id int NOT NULL DEFAULT '0',
  reference varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  old_average_cost decimal(15,4) DEFAULT NULL,
  new_average_cost decimal(15,4) DEFAULT NULL,
  user_id int NOT NULL DEFAULT '0',
  cost_before_movement decimal(15,4) DEFAULT NULL COMMENT 'التكلفة قبل الحركة',
  cost_after_movement decimal(15,4) DEFAULT NULL COMMENT 'التكلفة بعد الحركة',
  movement_value decimal(15,4) DEFAULT NULL COMMENT 'قيمة الحركة بالتكلفة',
  effect_on_cost enum('increase','decrease','no_change') COLLATE utf8mb4_general_ci DEFAULT NULL,
  detailed_calculation text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  related_costs decimal(15,4) DEFAULT NULL,
  is_cost_finalized tinyint(1) NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_option (
  product_option_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  option_id int NOT NULL,
  value mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  required tinyint(1) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_option_value (
  product_option_value_id int NOT NULL,
  product_option_id int NOT NULL,
  product_id int NOT NULL,
  option_id int NOT NULL,
  option_value_id int NOT NULL,
  quantity int NOT NULL,
  subtract tinyint(1) NOT NULL,
  price decimal(15,4) NOT NULL,
  price_prefix varchar(1) COLLATE utf8mb4_general_ci NOT NULL,
  points int NOT NULL,
  points_prefix varchar(1) COLLATE utf8mb4_general_ci NOT NULL,
  weight decimal(15,8) NOT NULL,
  weight_prefix varchar(1) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_price_history (
  history_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  old_price decimal(15,4) NOT NULL DEFAULT '0.0000',
  new_price decimal(15,4) NOT NULL DEFAULT '0.0000',
  change_date datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  change_type enum('manual','cost_update','import','system') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'manual',
  changed_by int NOT NULL,
  notes text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_pricing (
  product_pricing_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  base_price decimal(15,2) NOT NULL DEFAULT '0.00',
  special_price decimal(15,2) DEFAULT NULL,
  wholesale_price decimal(15,2) DEFAULT NULL,
  half_wholesale_price decimal(15,2) DEFAULT NULL,
  last_updated datetime DEFAULT NULL,
  custom_price decimal(15,2) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_quantity_discounts (
  discount_id int NOT NULL,
  product_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  type enum('buy_x_get_y','buy_x_get_discount') COLLATE utf8mb4_general_ci NOT NULL,
  buy_quantity int NOT NULL,
  get_quantity int NOT NULL,
  discount_type enum('percentage','fixed') COLLATE utf8mb4_general_ci NOT NULL,
  discount_value decimal(15,4) NOT NULL,
  status tinyint(1) NOT NULL DEFAULT '1',
  unit_id int DEFAULT '37',
  date_start date DEFAULT NULL,
  date_end date DEFAULT NULL,
  notes mediumtext COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_recommendation (
  recommendation_id int NOT NULL,
  product_id int NOT NULL,
  related_product_id int NOT NULL,
  unit_id int NOT NULL,
  customer_group_id int DEFAULT NULL,
  discount_type enum('percentage','fixed') COLLATE utf8mb4_general_ci DEFAULT NULL,
  discount_value decimal(15,4) DEFAULT NULL,
  type enum('upsell','cross_sell') COLLATE utf8mb4_general_ci NOT NULL,
  priority int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_recurring (
  product_id int NOT NULL,
  recurring_id int NOT NULL,
  customer_group_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_related (
  product_id int NOT NULL,
  related_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_reward (
  product_reward_id int NOT NULL,
  product_id int NOT NULL DEFAULT '0',
  customer_group_id int NOT NULL DEFAULT '0',
  points int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_to_category (
  product_id int NOT NULL,
  category_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_to_layout (
  product_id int NOT NULL,
  store_id int NOT NULL,
  layout_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_to_store (
  product_id int NOT NULL,
  store_id int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_product_unit (
  product_unit_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  unit_type enum('base','additional') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'base',
  conversion_factor decimal(15,4) NOT NULL DEFAULT '1.0000'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_pt_transactions (
  id int NOT NULL,
  order_id int NOT NULL,
  payment_method varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  transaction_ref varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  parent_ref varchar(64) COLLATE utf8mb4_general_ci DEFAULT NULL,
  transaction_type varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  transaction_status tinyint(1) NOT NULL,
  transaction_amount decimal(15,4) NOT NULL,
  transaction_currency varchar(8) COLLATE utf8mb4_general_ci NOT NULL,
  created_at timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_document (
  document_id int NOT NULL,
  reference_type enum('requisition','rfq','purchase_order','goods_receipt','supplier_invoice','vendor_payment','purchase_return') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  reference_id int NOT NULL,
  document_name varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  file_path varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  file_size int UNSIGNED NOT NULL DEFAULT '0' COMMENT 'حجم الملف بالبايت',
  document_type varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'نوع محتوى الملف',
  is_public tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل الملف متاح للعامة',
  uploaded_by int NOT NULL,
  upload_date datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_log (
  log_id int NOT NULL,
  reference_id int NOT NULL,
  reference_type enum('requisition','quote','purchase_order','goods_receipt','invoice','payment') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  action varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  user_id int NOT NULL,
  details text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_matching (
  matching_id int NOT NULL,
  po_id int NOT NULL COMMENT 'Purchase Order ID',
  receipt_id int DEFAULT NULL COMMENT 'Goods Receipt ID',
  invoice_id int DEFAULT NULL COMMENT 'Supplier Invoice ID',
  status enum('pending','matched','partial','mismatch') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  matched_by int DEFAULT NULL COMMENT 'User who performed matching',
  matched_at datetime DEFAULT NULL COMMENT 'Matching date/time',
  notes text COLLATE utf8mb4_general_ci COMMENT 'Matching notes',
  total_variance_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  requires_approval tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل يتطلب موافقة على المطابقة',
  approved_by int DEFAULT NULL,
  approved_at datetime DEFAULT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_matching_item (
  matching_item_id int NOT NULL,
  matching_id int NOT NULL,
  po_item_id int NOT NULL COMMENT 'PO Item ID',
  receipt_item_id int DEFAULT NULL COMMENT 'Receipt Item ID',
  invoice_item_id int DEFAULT NULL COMMENT 'Invoice Item ID',
  quantity_ordered decimal(15,4) NOT NULL COMMENT 'Ordered quantity',
  quantity_received decimal(15,4) DEFAULT NULL COMMENT 'Received quantity',
  quantity_invoiced decimal(15,4) DEFAULT NULL COMMENT 'Invoiced quantity',
  unit_price_ordered decimal(15,4) NOT NULL COMMENT 'Price in PO',
  unit_price_invoiced decimal(15,4) DEFAULT NULL COMMENT 'Price in Invoice',
  status enum('pending','matched','mismatch') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  variance_amount decimal(15,4) DEFAULT NULL COMMENT 'Price variance amount',
  variance_notes text COLLATE utf8mb4_general_ci COMMENT 'Variance explanation',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_order (
  po_id int NOT NULL,
  po_number varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  quotation_id int DEFAULT NULL,
  supplier_id int NOT NULL,
  user_id int NOT NULL,
  status enum('draft','pending_review','approved','rejected','cancelled','completed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'draft',
  order_date date NOT NULL,
  expected_delivery_date date DEFAULT NULL,
  subtotal decimal(15,4) NOT NULL DEFAULT '0.0000',
  tax_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  discount_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  total_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  notes text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL,
  created_by int NOT NULL,
  updated_at datetime NOT NULL,
  updated_by int NOT NULL,
  source_type enum('direct','requisition','quotation') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'direct' COMMENT 'مصدر أمر الشراء',
  source_id int DEFAULT NULL COMMENT 'معرف المصدر (رقم الطلب أو العرض)',
  payment_terms text COLLATE utf8mb4_general_ci COMMENT 'شروط الدفع',
  delivery_terms text COLLATE utf8mb4_general_ci COMMENT 'شروط التسليم',
  currency_id int NOT NULL DEFAULT '1' COMMENT 'العملة',
  exchange_rate decimal(15,6) NOT NULL DEFAULT '1.000000' COMMENT 'سعر الصرف',
  is_cost_updated tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل تم تحديث التكلفة',
  financial_approval tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل تمت الموافقة المالية',
  financial_approved_by int DEFAULT NULL COMMENT 'من اعتمد مالياً',
  financial_approval_date datetime DEFAULT NULL COMMENT 'تاريخ الاعتماد المالي',
  budget_allocated decimal(15,4) DEFAULT NULL COMMENT 'المبلغ المخصص من الموازنة'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_order_history (
  history_id int NOT NULL,
  po_id int NOT NULL,
  user_id int NOT NULL,
  action varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_order_item (
  po_item_id int NOT NULL,
  po_id int NOT NULL,
  product_id int NOT NULL,
  quantity decimal(15,4) NOT NULL,
  unit_id int NOT NULL,
  unit_price decimal(15,4) NOT NULL,
  tax_rate decimal(5,2) NOT NULL DEFAULT '0.00',
  discount_rate decimal(5,2) NOT NULL DEFAULT '0.00',
  total_price decimal(15,4) NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  original_unit_price decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'السعر الأصلي بعملة المورد',
  exchange_rate decimal(15,6) NOT NULL DEFAULT '1.000000' COMMENT 'سعر الصرف عند الإنشاء',
  is_received tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل تم الاستلام',
  received_quantity decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'الكمية المستلمة',
  source_item_id int DEFAULT NULL COMMENT 'معرف البند المصدر (من الطلب أو العرض)',
  average_cost decimal(15,4) DEFAULT NULL COMMENT 'متوسط التكلفة المحسوب',
  original_cost decimal(15,4) DEFAULT NULL COMMENT 'التكلفة الأصلية قبل التعديل',
  cost_updated_at datetime DEFAULT NULL COMMENT 'تاريخ تحديث التكلفة',
  cost_updated_by int DEFAULT NULL COMMENT 'من قام بتحديث التكلفة',
  budget_line_id int DEFAULT NULL COMMENT 'بند الموازنة المرتبط'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_order_tracking (
  tracking_id int NOT NULL,
  po_id int NOT NULL,
  status_change enum('created','sent_to_vendor','confirmed_by_vendor','partially_received','fully_received','cancelled','closed') COLLATE utf8mb4_general_ci NOT NULL,
  status_date datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  expected_delivery_date date DEFAULT NULL,
  actual_delivery_date date DEFAULT NULL,
  notes text COLLATE utf8mb4_general_ci,
  created_by int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_price_variance (
  variance_id int NOT NULL,
  product_id int NOT NULL,
  branch_id int NOT NULL,
  receipt_id int DEFAULT NULL COMMENT 'معرف استلام البضاعة',
  invoice_id int DEFAULT NULL COMMENT 'معرف فاتورة المورد',
  po_id int DEFAULT NULL COMMENT 'معرف أمر الشراء',
  receipt_price decimal(15,4) NOT NULL COMMENT 'سعر الاستلام الأولي',
  invoice_price decimal(15,4) NOT NULL COMMENT 'سعر الفاتورة النهائي',
  quantity decimal(15,4) NOT NULL COMMENT 'الكمية المستلمة',
  remaining_quantity decimal(15,4) NOT NULL COMMENT 'الكمية المتبقية عند وصول الفاتورة',
  variance_amount decimal(15,4) NOT NULL COMMENT 'مبلغ الفرق الإجمالي',
  adjustment_to_inventory decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'مبلغ تعديل المخزون',
  adjustment_to_cogs decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'مبلغ تعديل تكلفة المبيعات',
  adjustment_date datetime NOT NULL,
  adjustment_type enum('cost_update','variance_account') COLLATE utf8mb4_general_ci NOT NULL COMMENT 'نوع التعديل',
  journal_id int DEFAULT NULL COMMENT 'معرف القيد المحاسبي',
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_quotation (
  quotation_id int NOT NULL,
  quotation_number varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  requisition_id int NOT NULL,
  supplier_id int NOT NULL,
  currency_id int NOT NULL,
  total_amount decimal(15,4) NOT NULL,
  is_expired tinyint(1) NOT NULL DEFAULT '0',
  exchange_rate decimal(15,6) NOT NULL DEFAULT '1.000000',
  status enum('draft','pending','approved','rejected','converted') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'draft',
  rejection_reason text COLLATE utf8mb4_general_ci,
  validity_date date DEFAULT NULL,
  delivery_terms text COLLATE utf8mb4_general_ci,
  payment_terms text COLLATE utf8mb4_general_ci,
  notes text COLLATE utf8mb4_general_ci,
  comparison_notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  technical_approval tinyint(1) NOT NULL DEFAULT '0',
  technical_approved_by int DEFAULT NULL,
  technical_approval_date datetime DEFAULT NULL,
  financial_approval tinyint(1) NOT NULL DEFAULT '0',
  financial_approved_by int DEFAULT NULL,
  financial_approval_date datetime DEFAULT NULL,
  attachment_count int NOT NULL DEFAULT '0',
  is_best_offer tinyint(1) NOT NULL DEFAULT '0',
  subtotal decimal(15,2) NOT NULL DEFAULT '0.00',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  created_by int NOT NULL,
  updated_by int DEFAULT NULL,
  tax_included tinyint(1) NOT NULL DEFAULT '0',
  tax_rate decimal(5,2) NOT NULL DEFAULT '0.00',
  discount_type varchar(10) COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'fixed',
  has_discount tinyint(1) NOT NULL DEFAULT '0',
  discount_value decimal(15,4) NOT NULL DEFAULT '0.0000',
  discount_amount decimal(15,2) NOT NULL DEFAULT '0.00',
  tax_amount decimal(15,2) NOT NULL DEFAULT '0.00'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_quotation_history (
  history_id int NOT NULL,
  quotation_id int NOT NULL,
  user_id int NOT NULL,
  action varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_quotation_item (
  quotation_item_id int NOT NULL,
  quotation_id int NOT NULL,
  requisition_item_id int NOT NULL,
  product_id int NOT NULL,
  alternative_product_id int DEFAULT NULL,
  is_alternative tinyint(1) NOT NULL DEFAULT '0',
  unit_id int NOT NULL,
  quantity decimal(15,4) NOT NULL DEFAULT '0.0000',
  unit_price decimal(15,4) NOT NULL DEFAULT '0.0000',
  line_total decimal(15,4) NOT NULL DEFAULT '0.0000',
  tax_rate decimal(5,2) NOT NULL DEFAULT '0.00',
  discount_rate decimal(5,2) NOT NULL DEFAULT '0.00',
  discount_type enum('percentage','fixed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'fixed',
  tax_amount decimal(15,2) NOT NULL DEFAULT '0.00',
  discount_amount decimal(15,2) NOT NULL DEFAULT '0.00',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  delivery_time varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  warranty_period varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  is_best_price tinyint(1) NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_requisition (
  requisition_id int NOT NULL,
  req_number varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  user_id int NOT NULL,
  branch_id int NOT NULL,
  user_group_id int NOT NULL,
  status enum('draft','pending','approved','rejected','cancelled','processing','completed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'draft',
  rejection_reason text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  priority enum('low','medium','high','urgent') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'medium',
  required_date date DEFAULT NULL COMMENT 'التاريخ المتوقع للاستلام',
  notes mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  created_by int NOT NULL,
  updated_by int DEFAULT NULL,
  date_modified datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_requisition_history (
  history_id int NOT NULL,
  requisition_id int NOT NULL,
  user_id int NOT NULL,
  action varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  description text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_requisition_item (
  requisition_item_id int NOT NULL,
  requisition_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  quantity decimal(15,4) NOT NULL,
  description text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_return (
  return_id int NOT NULL,
  return_number varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  supplier_id int NOT NULL,
  purchase_order_id int DEFAULT NULL,
  goods_receipt_id int DEFAULT NULL,
  return_date date NOT NULL,
  status enum('pending','approved','completed','cancelled') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  total_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL,
  updated_at datetime NOT NULL,
  journal_ref int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_return_history (
  history_id int NOT NULL,
  return_id int NOT NULL,
  user_id int NOT NULL,
  action varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_purchase_return_item (
  return_item_id int NOT NULL,
  return_id int NOT NULL,
  product_id int NOT NULL,
  quantity decimal(15,4) NOT NULL,
  unit_id int NOT NULL,
  price decimal(15,4) NOT NULL,
  total decimal(15,4) NOT NULL,
  reason text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_quality_inspection (
  inspection_id int NOT NULL,
  inspection_number varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  receipt_id int NOT NULL,
  inspector_id int NOT NULL,
  status enum('pending','passed','failed','partially_passed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  inspection_date date NOT NULL,
  notes text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL,
  updated_at datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_quality_inspection_history (
  history_id int NOT NULL,
  inspection_id int NOT NULL,
  user_id int NOT NULL,
  action varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_quality_inspection_result (
  result_id int NOT NULL,
  goods_receipt_id int NOT NULL,
  receipt_item_id int NOT NULL,
  checked_by int NOT NULL,
  check_date datetime NOT NULL,
  result enum('passed','failed') COLLATE utf8mb4_general_ci NOT NULL,
  notes text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_queue_jobs (
  id int NOT NULL,
  job mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  status enum('pending','processing','done','failed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  attempts int NOT NULL DEFAULT '0',
  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_quotation_signatures (
  signature_id int NOT NULL,
  reference_type enum('quotation','comparison','purchase_order') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  reference_id int NOT NULL,
  user_id int NOT NULL,
  position varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  signature_date datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  signature_image varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  order_num int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_receipts (
  receipt_id int NOT NULL,
  customer_id int NOT NULL,
  order_id int NOT NULL,
  seller_rin varchar(30) COLLATE utf8mb4_general_ci DEFAULT NULL,
  seller_name varchar(200) COLLATE utf8mb4_general_ci DEFAULT NULL,
  buyer_type varchar(1) COLLATE utf8mb4_general_ci DEFAULT NULL,
  buyer_id varchar(30) COLLATE utf8mb4_general_ci DEFAULT NULL,
  buyer_name varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  total_sales decimal(13,5) DEFAULT NULL,
  total_commercial_discount decimal(13,5) DEFAULT NULL,
  total_items_discount decimal(13,5) DEFAULT NULL,
  extra_discount decimal(13,5) DEFAULT NULL,
  net_amount decimal(13,5) DEFAULT NULL,
  fees_amount decimal(13,5) DEFAULT NULL,
  total_amount decimal(13,5) DEFAULT NULL,
  tax_totals text COLLATE utf8mb4_general_ci,
  payment_method varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  date_time_issued datetime DEFAULT NULL,
  submission_uuid varchar(36) COLLATE utf8mb4_general_ci DEFAULT NULL,
  status enum('pending','submitted','accepted','rejected') COLLATE utf8mb4_general_ci DEFAULT 'pending',
  rejection_reason text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_recommendation_rule (
  rule_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  condition_type enum('category','price_range','customer_group','purchase_history') COLLATE utf8mb4_general_ci NOT NULL,
  condition_value text COLLATE utf8mb4_general_ci NOT NULL,
  recommendation_type enum('upsell','cross_sell') COLLATE utf8mb4_general_ci NOT NULL,
  product_ids text COLLATE utf8mb4_general_ci NOT NULL,
  priority int NOT NULL DEFAULT '0',
  status tinyint(1) NOT NULL DEFAULT '1'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_report_execution_log (
  execution_id int NOT NULL,
  report_id int NOT NULL,
  execution_start datetime NOT NULL,
  execution_end datetime DEFAULT NULL,
  status enum('started','completed','failed') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'started',
  file_path varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  error_message text COLLATE utf8mb4_general_ci,
  sent_to text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_return (
  return_id int NOT NULL,
  order_id int NOT NULL,
  product_id int NOT NULL,
  customer_id int NOT NULL,
  firstname varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  lastname varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  email varchar(96) COLLATE utf8mb4_general_ci NOT NULL,
  telephone varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  product varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  model varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  quantity int NOT NULL,
  opened tinyint(1) NOT NULL,
  return_reason_id int NOT NULL,
  return_action_id int NOT NULL,
  return_status_id int NOT NULL,
  comment mediumtext COLLATE utf8mb4_general_ci,
  date_ordered date DEFAULT NULL,
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_return_action (
  return_action_id int NOT NULL,
  language_id int NOT NULL DEFAULT '0',
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_return_history (
  return_history_id int NOT NULL,
  return_id int NOT NULL,
  return_status_id int NOT NULL,
  notify tinyint(1) NOT NULL,
  comment mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_return_reason (
  return_reason_id int NOT NULL,
  language_id int NOT NULL DEFAULT '0',
  name varchar(128) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_return_status (
  return_status_id int NOT NULL,
  language_id int NOT NULL DEFAULT '0',
  name varchar(32) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_review (
  review_id int NOT NULL,
  product_id int NOT NULL,
  customer_id int NOT NULL,
  author varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  text mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  rating int NOT NULL,
  status tinyint(1) NOT NULL DEFAULT '0',
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_risk_register (
  risk_id int NOT NULL,
  title varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'عنوان الخطر',
  description text COLLATE utf8mb4_general_ci COMMENT 'تفاصيل الخطر',
  risk_category varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'تصنيف الخطر: مالي، قانوني، تشغيل...',
  likelihood enum('low','medium','high') COLLATE utf8mb4_general_ci DEFAULT 'medium' COMMENT 'احتمالية الحدوث',
  impact enum('low','medium','high') COLLATE utf8mb4_general_ci DEFAULT 'medium' COMMENT 'تأثير الخطر',
  owner_user_id int DEFAULT NULL COMMENT 'من المسؤول عن مراقبة هذا الخطر',
  mitigation_plan text COLLATE utf8mb4_general_ci COMMENT 'خطة الحد من الخطر',
  status enum('open','mitigated','closed') COLLATE utf8mb4_general_ci DEFAULT 'open',
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_modified datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  owner_group_id int NOT NULL DEFAULT '0',
  nature_of_risk enum('ongoing','one_time') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'ongoing',
  risk_start_date date DEFAULT NULL,
  risk_end_date date DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_sales_forecast (
  forecast_id int NOT NULL,
  product_id int NOT NULL,
  branch_id int NOT NULL,
  forecast_date date NOT NULL,
  forecast_quantity decimal(15,4) NOT NULL,
  forecast_amount decimal(15,4) NOT NULL,
  confidence_level decimal(5,2) NOT NULL DEFAULT '90.00',
  method varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'moving_average',
  actual_quantity decimal(15,4) DEFAULT NULL,
  variance_percentage decimal(5,2) DEFAULT NULL,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_sales_quotation (
  quotation_id int NOT NULL,
  quotation_number varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  customer_id int NOT NULL,
  branch_id int NOT NULL,
  quotation_date date NOT NULL,
  valid_until date NOT NULL,
  status varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'draft',
  total_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  discount_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  tax_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  net_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  converted_to_order tinyint(1) NOT NULL DEFAULT '0',
  order_id int DEFAULT NULL,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_sales_quotation_item (
  item_id int NOT NULL,
  quotation_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  quantity decimal(15,4) NOT NULL,
  price decimal(15,4) NOT NULL,
  discount_rate decimal(5,2) NOT NULL DEFAULT '0.00',
  tax_rate decimal(5,2) NOT NULL DEFAULT '0.00',
  total decimal(15,4) NOT NULL,
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_scheduled_report (
  report_id int NOT NULL,
  report_name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  report_type varchar(100) COLLATE utf8mb4_general_ci NOT NULL,
  parameters text COLLATE utf8mb4_general_ci NOT NULL,
  format enum('pdf','excel','csv','html') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pdf',
  frequency enum('daily','weekly','monthly','quarterly','yearly') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'monthly',
  next_run datetime NOT NULL,
  last_run datetime DEFAULT NULL,
  recipients text COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  status tinyint(1) NOT NULL DEFAULT '1',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_dashboard_widget tinyint(1) NOT NULL DEFAULT '0',
  widget_title varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  widget_type varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT 'table',
  access_groups text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_seo_internal_link (
  link_id int NOT NULL,
  source_page varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  target_page varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  anchor_text varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL DEFAULT '1',
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_seo_keyword_tracking (
  tracking_id int NOT NULL,
  keyword varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  search_engine varchar(50) COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'google',
  position int DEFAULT NULL,
  url varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL,
  last_checked datetime NOT NULL,
  previous_position int DEFAULT NULL,
  status enum('improved','declined','unchanged','new') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'new'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_seo_page_analysis (
  analysis_id int NOT NULL,
  page_url varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  target_keyword varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  title_score int NOT NULL DEFAULT '0',
  meta_score int NOT NULL DEFAULT '0',
  content_score int NOT NULL DEFAULT '0',
  technical_score int NOT NULL DEFAULT '0',
  overall_score int NOT NULL DEFAULT '0',
  suggestions text COLLATE utf8mb4_general_ci,
  date_analysis datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_seo_settings (
  setting_id int NOT NULL,
  code varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  `key` varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  value text COLLATE utf8mb4_general_ci NOT NULL,
  serialized tinyint(1) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_seo_url (
  seo_url_id int NOT NULL,
  store_id int NOT NULL,
  language_id int NOT NULL,
  query varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  keyword varchar(255) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_session (
  session_id varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  data mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  expire datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_setting (
  setting_id int NOT NULL,
  store_id int NOT NULL DEFAULT '0',
  code varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  `key` varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  value mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  serialized tinyint(1) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_shipping_company (
  company_id int NOT NULL,
  name varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  website varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  contact_name varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  contact_phone varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  contact_email varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  api_url varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  status enum('active','inactive') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  logo varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  account_number varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  tracking_url_template varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'قالب URL لتتبع الشحنة: {tracking_number}',
  supports_cod tinyint(1) NOT NULL DEFAULT '0' COMMENT 'يدعم الدفع عند الاستلام',
  supports_api tinyint(1) NOT NULL DEFAULT '0' COMMENT 'يدعم الربط عبر API',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_shipping_company_config (
  config_id int NOT NULL,
  company_id int NOT NULL,
  `key` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  value text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  is_sensitive tinyint(1) NOT NULL DEFAULT '0',
  environment enum('live','test','both') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'both',
  last_updated datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  updated_by int DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_shipping_courier (
  shipping_courier_id int NOT NULL,
  shipping_courier_code varchar(255) COLLATE utf8mb4_general_ci NOT NULL DEFAULT '',
  shipping_courier_name varchar(255) COLLATE utf8mb4_general_ci NOT NULL DEFAULT ''
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_shipping_coverage (
  coverage_id int NOT NULL,
  company_id int NOT NULL,
  zone_id int DEFAULT NULL COMMENT 'المنطقة من جدول zone',
  country_id int DEFAULT NULL COMMENT 'الدولة من جدول country',
  geo_zone_id int DEFAULT NULL COMMENT 'المنطقة الجغرافية',
  city varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'مدينة محددة',
  area varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'منطقة محددة',
  zip_code varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'الرمز البريدي',
  priority enum('primary','secondary','backup') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'primary',
  delivery_days int NOT NULL DEFAULT '1' COMMENT 'أيام التوصيل المتوقعة',
  delivery_days_max int DEFAULT NULL COMMENT 'الحد الأقصى لأيام التوصيل',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_shipping_order (
  shipping_order_id int NOT NULL,
  order_id int NOT NULL,
  company_id int NOT NULL,
  tracking_number varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  shipment_date datetime DEFAULT NULL,
  scheduled_delivery_date date DEFAULT NULL,
  actual_delivery_date datetime DEFAULT NULL,
  shipping_cost decimal(15,4) NOT NULL DEFAULT '0.0000',
  cod_amount decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'مبلغ الدفع عند الاستلام',
  status enum('pending','processed','shipped','in_transit','delivered','returned','failed','cancelled') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  package_weight decimal(10,2) DEFAULT NULL,
  package_dimensions varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'الأبعاد بالسنتيمتر: طول×عرض×ارتفاع',
  shipping_label_url varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  invoice_url varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  awb_number varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'رقم بوليصة الشحن',
  api_response mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci COMMENT 'استجابة API للشحن',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_shipping_rate (
  rate_id int NOT NULL,
  company_id int NOT NULL,
  coverage_id int DEFAULT NULL,
  weight_from decimal(10,2) NOT NULL DEFAULT '0.00',
  weight_to decimal(10,2) DEFAULT NULL,
  price decimal(15,4) NOT NULL,
  price_type enum('fixed','per_kg','percentage') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'fixed',
  min_price decimal(15,4) DEFAULT NULL,
  max_price decimal(15,4) DEFAULT NULL,
  additional_kg_price decimal(15,4) DEFAULT NULL COMMENT 'سعر الكيلو الإضافي',
  cod_fee decimal(15,4) DEFAULT NULL COMMENT 'رسوم الدفع عند الاستلام',
  cod_fee_type enum('fixed','percentage') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  effective_from date NOT NULL,
  effective_to date DEFAULT NULL,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_shipping_settlement (
  settlement_id int NOT NULL,
  company_id int NOT NULL,
  settlement_date date NOT NULL,
  reference_number varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  total_orders int NOT NULL DEFAULT '0',
  total_cod_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  shipping_fees decimal(15,4) NOT NULL DEFAULT '0.0000',
  cod_fees decimal(15,4) NOT NULL DEFAULT '0.0000',
  net_amount decimal(15,4) NOT NULL COMMENT 'المبلغ الصافي للتسوية',
  payment_direction enum('to_company','from_company') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'اتجاه الدفع: لنا أو علينا',
  status enum('pending','reconciled','disputed') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  bank_transaction_id int DEFAULT NULL,
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  reconciled_by int DEFAULT NULL,
  reconciled_at datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_shipping_settlement_order (
  settlement_order_id int NOT NULL,
  settlement_id int NOT NULL,
  shipping_order_id int NOT NULL,
  cod_amount decimal(15,4) NOT NULL DEFAULT '0.0000',
  shipping_cost decimal(15,4) NOT NULL DEFAULT '0.0000',
  cod_fee decimal(15,4) NOT NULL DEFAULT '0.0000',
  status enum('matched','unmatched','disputed') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'matched',
  discrepancy_amount decimal(15,4) DEFAULT NULL,
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_shipping_tracking (
  tracking_id int NOT NULL,
  shipping_order_id int NOT NULL,
  status varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  status_details text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  tracking_date datetime NOT NULL,
  location varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  agent_name varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  source enum('api','manual','customer') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'api',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by int DEFAULT NULL COMMENT 'NULL إذا كان من API'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_statistics (
  statistics_id int NOT NULL,
  code varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  value decimal(15,4) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_stock_adjustment (
  adjustment_id int NOT NULL,
  journal_id int NOT NULL DEFAULT '0',
  adjustment_number varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  branch_id int NOT NULL,
  type enum('increase','decrease') COLLATE utf8mb4_general_ci NOT NULL,
  status enum('draft','approved','cancelled') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'draft',
  adjustment_date date NOT NULL,
  notes text COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  approved_by int DEFAULT NULL,
  created_at datetime NOT NULL,
  updated_at datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_stock_adjustment_history (
  history_id int NOT NULL,
  adjustment_id int NOT NULL,
  user_id int NOT NULL,
  action varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_stock_adjustment_item (
  adjustment_item_id int NOT NULL,
  adjustment_id int NOT NULL,
  product_id int NOT NULL,
  quantity decimal(15,4) NOT NULL,
  unit_id int NOT NULL,
  reason text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_stock_count (
  stock_count_id int NOT NULL,
  branch_id int NOT NULL COMMENT 'الفرع/المخزن الذي يتم الجرد فيه',
  reference_code varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'يمكن تخزين رقم الجرد أو رمز معين لاستخدامه في الطباعة',
  count_date date NOT NULL COMMENT 'تاريخ الجرد الفعلي',
  status enum('draft','in_progress','completed','cancelled') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'draft' COMMENT 'الحالة: تحت الإنشاء، قيد الجرد، منتهية، ملغاة',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci COMMENT 'ملاحظات عامة حول الجرد',
  created_by int NOT NULL COMMENT 'منشئ جلسة الجرد',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_by int DEFAULT NULL,
  updated_at datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_stock_count_item (
  count_item_id int NOT NULL,
  stock_count_id int NOT NULL COMMENT 'FK إلى رأس الجرد',
  product_id int NOT NULL COMMENT 'رقم المنتج',
  unit_id int NOT NULL COMMENT 'الوحدة التي يتم الجرد بها',
  system_qty decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'الكمية المسجلة في النظام قبل الجرد',
  counted_qty decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'الكمية التي وجدها الموظف فعليًا',
  difference decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT '(counted_qty - system_qty)',
  barcode varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'في حال تم إدخال الباركود أثناء عملية الجرد، للبحث السريع',
  notes text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_stock_status (
  stock_status_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(32) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_stock_transfer (
  transfer_id int NOT NULL,
  journal_id int NOT NULL DEFAULT '0',
  transfer_number varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  from_branch_id int NOT NULL,
  to_branch_id int NOT NULL,
  status enum('pending','in_transit','completed','cancelled') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  transfer_date date NOT NULL,
  notes text COLLATE utf8mb4_general_ci,
  created_by int NOT NULL,
  created_at datetime NOT NULL,
  updated_at datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_stock_transfer_history (
  history_id int NOT NULL,
  transfer_id int NOT NULL,
  user_id int NOT NULL,
  action varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_stock_transfer_item (
  transfer_item_id int NOT NULL,
  transfer_id int NOT NULL,
  product_id int NOT NULL,
  quantity decimal(15,4) NOT NULL,
  unit_id int NOT NULL,
  notes text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_store (
  store_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  url varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  `ssl` varchar(255) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_supplier (
  supplier_id int NOT NULL,
  account_code bigint DEFAULT NULL,
  supplier_group_id int NOT NULL,
  store_id int NOT NULL DEFAULT '0',
  language_id int NOT NULL,
  firstname varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  lastname varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  email varchar(96) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  telephone varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  fax varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  password varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  salt varchar(9) COLLATE utf8mb4_general_ci NOT NULL,
  cart mediumtext COLLATE utf8mb4_general_ci,
  wishlist mediumtext COLLATE utf8mb4_general_ci,
  newsletter tinyint(1) NOT NULL DEFAULT '0',
  address_id int NOT NULL DEFAULT '0',
  custom_field mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL,
  safe tinyint(1) NOT NULL,
  token mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_supplier_address (
  address_id int NOT NULL,
  supplier_id int NOT NULL,
  firstname varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  lastname varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  company varchar(40) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  address_1 varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  address_2 varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  city varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  postcode varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  country_id int NOT NULL DEFAULT '63',
  zone_id int NOT NULL DEFAULT '0',
  custom_field mediumtext COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_supplier_evaluation (
  evaluation_id int NOT NULL,
  supplier_id int NOT NULL,
  evaluator_id int NOT NULL,
  evaluation_date date NOT NULL,
  quality_score decimal(3,2) NOT NULL,
  delivery_score decimal(3,2) NOT NULL,
  price_score decimal(3,2) NOT NULL,
  service_score decimal(3,2) NOT NULL,
  overall_score decimal(3,2) NOT NULL,
  comments text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_supplier_group (
  supplier_group_id int NOT NULL,
  approval int NOT NULL,
  sort_order int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_supplier_group_description (
  supplier_group_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_supplier_invoice (
  invoice_id int NOT NULL,
  invoice_number varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  po_id int NOT NULL,
  vendor_id int NOT NULL,
  invoice_date date NOT NULL,
  due_date date NOT NULL,
  subtotal decimal(15,4) NOT NULL,
  tax_amount decimal(15,4) NOT NULL,
  discount_amount decimal(15,4) NOT NULL,
  total_amount decimal(15,4) NOT NULL,
  status enum('pending','approved','paid','cancelled') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  journal_id int NOT NULL DEFAULT '0',
  notes text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL,
  created_by int NOT NULL,
  updated_at datetime NOT NULL,
  updated_by int NOT NULL,
  journal_ref int DEFAULT NULL,
  matching_status enum('pending','matched','partial','mismatch') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending' COMMENT 'حالة المطابقة مع الاستلام وأمر الشراء',
  payment_status enum('unpaid','partially_paid','paid') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'unpaid' COMMENT 'حالة السداد',
  paid_amount decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'المبلغ المسدد',
  last_payment_date datetime DEFAULT NULL COMMENT 'تاريخ آخر سداد'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_supplier_invoice_history (
  history_id int NOT NULL,
  invoice_id int NOT NULL,
  user_id int NOT NULL,
  action varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_supplier_invoice_item (
  invoice_item_id int NOT NULL,
  invoice_id int NOT NULL,
  po_item_id int NOT NULL,
  product_id int NOT NULL,
  quantity decimal(15,4) NOT NULL,
  unit_id int NOT NULL,
  unit_price decimal(15,4) NOT NULL,
  tax_rate decimal(5,2) NOT NULL,
  discount_rate decimal(5,2) NOT NULL,
  total_price decimal(15,4) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_supplier_product_price (
  price_id int NOT NULL,
  supplier_id int NOT NULL,
  product_id int NOT NULL,
  unit_id int NOT NULL,
  currency_id int NOT NULL DEFAULT '1',
  price decimal(15,4) NOT NULL DEFAULT '0.0000',
  min_quantity decimal(15,4) DEFAULT NULL COMMENT 'الحد الأدنى للكمية بهذا السعر',
  is_default tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل هذا هو السعر الافتراضي',
  start_date date DEFAULT NULL COMMENT 'تاريخ بداية السعر',
  end_date date DEFAULT NULL COMMENT 'تاريخ نهاية السعر',
  last_purchase_date date DEFAULT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  notes text COLLATE utf8mb4_general_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_system_events (
  event_id int NOT NULL,
  event_type varchar(50) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'نوع الحدث',
  event_action varchar(50) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'الإجراء المتخذ',
  reference_type varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'نوع المرجع',
  reference_id int DEFAULT NULL COMMENT 'معرف المرجع',
  event_data text COLLATE utf8mb4_general_ci COMMENT 'بيانات الحدث بتنسيق JSON',
  user_id int DEFAULT NULL COMMENT 'المستخدم المسبب للحدث',
  ip_address varchar(45) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'عنوان IP',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_system_notifications (
  notification_id int NOT NULL AUTO_INCREMENT,
  title varchar(255) NOT NULL,
  content text NOT NULL,
  type varchar(32) NOT NULL,
  priority varchar(16) DEFAULT 'normal',
  link varchar(255),
  created_at datetime DEFAULT CURRENT_TIMESTAMP,
  expires_at datetime,
  PRIMARY KEY (notification_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_system_notifications (
  notification_id int NOT NULL,
  user_id int DEFAULT NULL,
  user_group_id int DEFAULT NULL,
  type enum('info','warning','error','success','alert') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'info',
  title varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  message text COLLATE utf8mb4_general_ci NOT NULL,
  reference_type varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL,
  reference_id int DEFAULT NULL,
  is_read tinyint(1) NOT NULL DEFAULT '0',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  expiry_date datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_task (
  task_id int NOT NULL,
  title varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  description text COLLATE utf8mb4_general_ci,
  assigned_to int NOT NULL COMMENT 'User ID the task is assigned to',
  assigned_by int NOT NULL COMMENT 'User ID who assigned the task',
  due_date date DEFAULT NULL,
  priority enum('low','medium','high','urgent') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'medium',
  completed tinyint(1) NOT NULL DEFAULT '0' COMMENT '0 = pending, 1 = completed',
  completed_at datetime DEFAULT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  reference_module varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'Optional: Module related to the task (e.g., order, customer)',
  reference_id int DEFAULT NULL COMMENT 'Optional: ID related to the module'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='Stores user tasks';

CREATE TABLE cod_tax_class (
  tax_class_id int NOT NULL,
  title varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  description varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_tax_rate (
  tax_rate_id int NOT NULL,
  geo_zone_id int NOT NULL DEFAULT '0',
  name varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  rate decimal(15,4) NOT NULL DEFAULT '0.0000',
  type char(1) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_tax_rate_to_customer_group (
  tax_rate_id int NOT NULL,
  customer_group_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_tax_rule (
  tax_rule_id int NOT NULL,
  tax_class_id int NOT NULL,
  tax_rate_id int NOT NULL,
  based varchar(10) COLLATE utf8mb4_general_ci NOT NULL,
  priority int NOT NULL DEFAULT '1'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_theme (
  theme_id int NOT NULL,
  store_id int NOT NULL,
  theme varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  route varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  code longtext COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_translation (
  translation_id int NOT NULL,
  store_id int NOT NULL,
  language_id int NOT NULL,
  route varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  `key` varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  value mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_unified_document (
  document_id int NOT NULL,
  title varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  description text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  document_type enum('contract','invoice','report','proposal','policy','other') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'other',
  file_path varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  file_name varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  file_size int UNSIGNED NOT NULL,
  file_type varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  version varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT '1.0',
  status enum('draft','pending_approval','approved','rejected','archived') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'draft',
  tags varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  department_id int DEFAULT NULL,
  creator_id int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  parent_document_id int DEFAULT NULL COMMENT 'المستند الأب في حالة الإصدارات',
  expiry_date date DEFAULT NULL COMMENT 'تاريخ انتهاء الصلاحية إن وجد',
  reference_module varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'المودل المرتبط مثل order, customer',
  reference_id int DEFAULT NULL COMMENT 'المعرف المرتبط بالمودل',
  is_template tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل المستند قالب',
  approval_workflow_id int DEFAULT NULL COMMENT 'معرف سير عمل الموافقة إن وجد'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_unified_notification (
  notification_id int NOT NULL,
  user_id int NOT NULL,
  title varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  content text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  module varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'المودل المُنشئ للإشعار',
  reference_type varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'نوع المرجع مثل message, order, approval',
  reference_id int DEFAULT NULL COMMENT 'معرف المرجع',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  read_at datetime DEFAULT NULL,
  expiry_at datetime DEFAULT NULL,
  priority enum('low','normal','high','urgent') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'normal',
  action_url varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT 'الرابط للعمل المطلوب',
  created_by int DEFAULT NULL COMMENT 'المستخدم المنشئ أو NULL للنظام'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_unified_workflow (
  workflow_id int NOT NULL,
  name varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  description text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  workflow_type enum('document_approval','purchase_approval','leave_request','expense_claim','payment_approval','other') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  status enum('active','inactive','archived') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  creator_id int NOT NULL,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  is_template tinyint(1) NOT NULL DEFAULT '0',
  department_id int DEFAULT NULL,
  escalation_enabled tinyint(1) NOT NULL DEFAULT '0' COMMENT 'تفعيل تصعيد الطلبات',
  escalation_after_days int DEFAULT NULL COMMENT 'التصعيد بعد عدد أيام',
  notify_creator tinyint(1) NOT NULL DEFAULT '1' COMMENT 'إشعار المنشئ بالتغييرات'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_unit (
  unit_id int NOT NULL,
  code varchar(10) COLLATE utf8mb4_general_ci NOT NULL,
  desc_en varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  desc_ar varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_unit_conversion_history (
  conversion_history_id int NOT NULL,
  product_id int NOT NULL,
  from_unit_id int NOT NULL,
  to_unit_id int NOT NULL,
  from_quantity decimal(15,4) NOT NULL,
  to_quantity decimal(15,4) NOT NULL,
  user_id int NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_upload (
  upload_id int NOT NULL,
  name varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  filename varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_user (
  user_id int NOT NULL,
  user_group_id int NOT NULL,
  branch_id int NOT NULL DEFAULT '2',
  username varchar(20) COLLATE utf8mb4_general_ci NOT NULL,
  password varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  salt varchar(9) COLLATE utf8mb4_general_ci NOT NULL,
  firstname varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  lastname varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  email varchar(96) COLLATE utf8mb4_general_ci NOT NULL,
  image varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  last_activity timestamp NULL DEFAULT NULL,
  ip varchar(40) COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_user_dashboard (
  dashboard_id int NOT NULL AUTO_INCREMENT,
  user_id int NOT NULL,
  name varchar(255) NOT NULL,
  is_default tinyint(1) NOT NULL DEFAULT 0,
  layout_config mediumtext,
  settings_config mediumtext,
  created_at datetime DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (dashboard_id),
  KEY user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_user_group (
  user_group_id int NOT NULL,
  name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  permission mediumtext COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_user_group_permission (
  user_group_id int NOT NULL,
  permission_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_user_kpi_assignment (
  assignment_id int NOT NULL,
  user_id int NOT NULL COMMENT 'FK referencing cod_user.user_id',
  kpi_code varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'Matches kpi_code in cod_dashboard_kpi',
  assigned_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='Links users to specific KPIs they can view or manage';

CREATE TABLE cod_user_login_log (
  log_id int NOT NULL,
  user_id int NOT NULL,
  login_time datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  logout_time datetime DEFAULT NULL,
  ip_address varchar(45) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  user_agent varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  status varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  failure_reason varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_user_permission (
  user_id int NOT NULL,
  permission_id int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_vendor_payment (
  payment_id int NOT NULL,
  payment_number varchar(50) COLLATE utf8mb4_general_ci NOT NULL,
  vendor_id int NOT NULL,
  payment_date date NOT NULL,
  amount decimal(15,4) NOT NULL,
  payment_method enum('cash','bank_transfer','cheque','credit_card') COLLATE utf8mb4_general_ci NOT NULL,
  reference_number varchar(100) COLLATE utf8mb4_general_ci DEFAULT NULL,
  status enum('pending','completed','cancelled') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  notes text COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL,
  created_by int NOT NULL,
  updated_at datetime NOT NULL,
  updated_by int NOT NULL,
  invoice_id int DEFAULT NULL COMMENT 'معرف فاتورة المورد',
  po_id int DEFAULT NULL COMMENT 'معرف أمر الشراء',
  currency_id int DEFAULT NULL COMMENT 'العملة',
  exchange_rate decimal(15,6) DEFAULT NULL COMMENT 'سعر الصرف',
  journal_id int DEFAULT NULL COMMENT 'معرف القيد المحاسبي'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_visitors_stats (
  visit_date date NOT NULL,
  visits int NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_voucher (
  voucher_id int NOT NULL,
  order_id int NOT NULL,
  code varchar(10) COLLATE utf8mb4_general_ci NOT NULL,
  from_name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  from_email varchar(96) COLLATE utf8mb4_general_ci NOT NULL,
  to_name varchar(64) COLLATE utf8mb4_general_ci NOT NULL,
  to_email varchar(96) COLLATE utf8mb4_general_ci NOT NULL,
  voucher_theme_id int NOT NULL,
  message mediumtext COLLATE utf8mb4_general_ci NOT NULL,
  amount decimal(15,4) NOT NULL,
  status tinyint(1) NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_voucher_history (
  voucher_history_id int NOT NULL,
  voucher_id int NOT NULL,
  order_id int NOT NULL,
  amount decimal(15,4) NOT NULL,
  date_added datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_voucher_theme (
  voucher_theme_id int NOT NULL,
  image varchar(255) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_voucher_theme_description (
  voucher_theme_id int NOT NULL,
  language_id int NOT NULL,
  name varchar(32) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_warranty (
  warranty_id int NOT NULL,
  order_id int NOT NULL,
  product_id int NOT NULL,
  customer_id int NOT NULL,
  warranty_status enum('active','expired','claimed','void') COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'active',
  start_date date NOT NULL,
  end_date date NOT NULL,
  notes text COLLATE utf8mb4_general_ci,
  date_added datetime NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_weight_class (
  weight_class_id int NOT NULL,
  value decimal(15,8) NOT NULL DEFAULT '0.00000000'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_weight_class_description (
  weight_class_id int NOT NULL,
  language_id int NOT NULL,
  title varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  unit varchar(4) COLLATE utf8mb4_general_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_workflow_approval (
  approval_id int NOT NULL,
  request_id int NOT NULL,
  step_id int NOT NULL,
  user_id int NOT NULL,
  action enum('approved','rejected','delegated','commented') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  comment text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  delegated_to int DEFAULT NULL COMMENT 'تفويض الموافقة لمستخدم آخر'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_workflow_request (
  request_id int NOT NULL,
  workflow_id int NOT NULL,
  current_step_id int DEFAULT NULL,
  requester_id int NOT NULL,
  title varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  description text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  status enum('draft','pending','in_progress','approved','rejected','cancelled') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'pending',
  priority enum('low','normal','high','urgent') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'normal',
  reference_module varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'المودل المرتبط مثل document, purchase',
  reference_id int NOT NULL COMMENT 'معرف المرجع',
  created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  completed_at datetime DEFAULT NULL,
  due_date datetime DEFAULT NULL COMMENT 'الموعد النهائي للطلب'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_workflow_step (
  step_id int NOT NULL,
  workflow_id int NOT NULL,
  step_name varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  step_order int NOT NULL,
  approver_user_id int DEFAULT NULL COMMENT 'المستخدم المعتمد أو NULL لمجموعة',
  approver_group_id int DEFAULT NULL COMMENT 'المجموعة المعتمدة أو NULL لمستخدم',
  approval_type enum('any_one','all','percentage','sequential') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT 'any_one',
  approval_percentage int DEFAULT NULL,
  is_final_step tinyint(1) NOT NULL DEFAULT '0',
  on_reject_goto_step int DEFAULT NULL COMMENT 'الخطوة التالية عند الرفض',
  instructions text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci,
  deadline_days int DEFAULT NULL COMMENT 'مهلة الموافقة بالأيام',
  reminder_days int DEFAULT NULL COMMENT 'تذكير قبل الموعد النهائي بأيام'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_zone (
  zone_id int NOT NULL,
  country_id int NOT NULL,
  name varchar(128) COLLATE utf8mb4_general_ci NOT NULL,
  code varchar(32) COLLATE utf8mb4_general_ci NOT NULL,
  status tinyint(1) NOT NULL DEFAULT '1'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE cod_zone_to_geo_zone (
  zone_to_geo_zone_id int NOT NULL,
  country_id int NOT NULL,
  zone_id int NOT NULL DEFAULT '0',
  geo_zone_id int NOT NULL,
  date_added datetime NOT NULL,
  date_modified datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Purchase Requisition Tables
CREATE TABLE IF NOT EXISTS `purchase_requisition` (
  `requisition_id` int(11) NOT NULL AUTO_INCREMENT,
  `req_number` varchar(20) NOT NULL,
  `branch_id` int(11) NOT NULL,
  `user_group_id` int(11) NOT NULL,
  `required_date` date DEFAULT NULL,
  `priority` enum('low','medium','high','urgent') NOT NULL DEFAULT 'low',
  `notes` text,
  `status` enum('draft','pending','approved','rejected','cancelled') NOT NULL DEFAULT 'draft',
  `created_by` int(11) NOT NULL,
  `updated_by` int(11) DEFAULT NULL,
  `created_at` datetime NOT NULL,
  `updated_at` datetime DEFAULT NULL,
  PRIMARY KEY (`requisition_id`),
  KEY `branch_id` (`branch_id`),
  KEY `user_group_id` (`user_group_id`),
  KEY `created_by` (`created_by`),
  KEY `updated_by` (`updated_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE IF NOT EXISTS `purchase_requisition_item` (
  `requisition_id` int(11) NOT NULL,
  `product_id` int(11) NOT NULL,
  `quantity` decimal(15,4) NOT NULL DEFAULT '0.0000',
  `unit_id` int(11) NOT NULL,
  `description` text,
  PRIMARY KEY (`requisition_id`,`product_id`),
  KEY `product_id` (`product_id`),
  KEY `unit_id` (`unit_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE IF NOT EXISTS `purchase_requisition_history` (
  `history_id` int(11) NOT NULL AUTO_INCREMENT,
  `requisition_id` int(11) NOT NULL,
  `user_id` int(11) NOT NULL,
  `action` varchar(50) NOT NULL,
  `description` text,
  `created_at` datetime NOT NULL,
  PRIMARY KEY (`history_id`),
  KEY `requisition_id` (`requisition_id`),
  KEY `user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Purchase Quotation Tables
CREATE TABLE IF NOT EXISTS `purchase_quotation` (
  `quotation_id` int(11) NOT NULL AUTO_INCREMENT,
  `quote_number` varchar(20) NOT NULL,
  `requisition_id` int(11) DEFAULT NULL,
  `supplier_id` int(11) NOT NULL,
  `currency_id` int(11) NOT NULL,
  `tax_included` tinyint(1) NOT NULL DEFAULT '0',
  `tax_rate` decimal(15,2) NOT NULL DEFAULT '0.00',
  `notes` text,
  `validity_date` date DEFAULT NULL,
  `status` enum('draft','sent','approved','rejected','expired') NOT NULL DEFAULT 'draft',
  `created_by` int(11) NOT NULL,
  `updated_by` int(11) DEFAULT NULL,
  `created_at` datetime NOT NULL,
  `updated_at` datetime DEFAULT NULL,
  PRIMARY KEY (`quotation_id`),
  KEY `requisition_id` (`requisition_id`),
  KEY `supplier_id` (`supplier_id`),
  KEY `currency_id` (`currency_id`),
  KEY `created_by` (`created_by`),
  KEY `updated_by` (`updated_by`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE IF NOT EXISTS `purchase_quotation_item` (
  `quotation_id` int(11) NOT NULL,
  `product_id` int(11) NOT NULL,
  `quantity` decimal(15,4) NOT NULL DEFAULT '0.0000',
  `unit_id` int(11) NOT NULL,
  `unit_price` decimal(15,4) NOT NULL DEFAULT '0.0000',
  `description` text,
  PRIMARY KEY (`quotation_id`,`product_id`),
  KEY `product_id` (`product_id`),
  KEY `unit_id` (`unit_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Inventory Cost History Table
CREATE TABLE IF NOT EXISTS `inventory_cost_history` (
  `history_id` int(11) NOT NULL AUTO_INCREMENT,
  `product_id` int(11) NOT NULL,
  `branch_id` int(11) NOT NULL,
  `cost` decimal(15,4) NOT NULL DEFAULT '0.0000',
  `date_added` datetime NOT NULL,
  PRIMARY KEY (`history_id`),
  KEY `product_id` (`product_id`),
  KEY `branch_id` (`branch_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Branch Inventory Snapshot Table
CREATE TABLE IF NOT EXISTS `branch_inventory_snapshot` (
  `branch_id` int(11) NOT NULL,
  `product_id` int(11) NOT NULL,
  `quantity` decimal(15,4) NOT NULL DEFAULT '0.0000',
  `cost` decimal(15,4) NOT NULL DEFAULT '0.0000',
  `last_movement_date` datetime NOT NULL,
  PRIMARY KEY (`branch_id`,`product_id`),
  KEY `product_id` (`product_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Foreign Key Constraints
ALTER TABLE `purchase_requisition`
  ADD CONSTRAINT `pr_branch_fk` FOREIGN KEY (`branch_id`) REFERENCES `branch` (`branch_id`),
  ADD CONSTRAINT `pr_user_group_fk` FOREIGN KEY (`user_group_id`) REFERENCES `user_group` (`user_group_id`),
  ADD CONSTRAINT `pr_created_by_fk` FOREIGN KEY (`created_by`) REFERENCES `user` (`user_id`),
  ADD CONSTRAINT `pr_updated_by_fk` FOREIGN KEY (`updated_by`) REFERENCES `user` (`user_id`);

ALTER TABLE `purchase_requisition_item`
  ADD CONSTRAINT `pri_requisition_fk` FOREIGN KEY (`requisition_id`) REFERENCES `purchase_requisition` (`requisition_id`) ON DELETE CASCADE,
  ADD CONSTRAINT `pri_product_fk` FOREIGN KEY (`product_id`) REFERENCES `product` (`product_id`),
  ADD CONSTRAINT `pri_unit_fk` FOREIGN KEY (`unit_id`) REFERENCES `unit` (`unit_id`);

ALTER TABLE `purchase_requisition_history`
  ADD CONSTRAINT `prh_requisition_fk` FOREIGN KEY (`requisition_id`) REFERENCES `purchase_requisition` (`requisition_id`) ON DELETE CASCADE,
  ADD CONSTRAINT `prh_user_fk` FOREIGN KEY (`user_id`) REFERENCES `user` (`user_id`);

ALTER TABLE `purchase_quotation`
  ADD CONSTRAINT `pq_requisition_fk` FOREIGN KEY (`requisition_id`) REFERENCES `purchase_requisition` (`requisition_id`),
  ADD CONSTRAINT `pq_supplier_fk` FOREIGN KEY (`supplier_id`) REFERENCES `supplier` (`supplier_id`),
  ADD CONSTRAINT `pq_currency_fk` FOREIGN KEY (`currency_id`) REFERENCES `currency` (`currency_id`),
  ADD CONSTRAINT `pq_created_by_fk` FOREIGN KEY (`created_by`) REFERENCES `user` (`user_id`),
  ADD CONSTRAINT `pq_updated_by_fk` FOREIGN KEY (`updated_by`) REFERENCES `user` (`user_id`);

ALTER TABLE `purchase_quotation_item`
  ADD CONSTRAINT `pqi_quotation_fk` FOREIGN KEY (`quotation_id`) REFERENCES `purchase_quotation` (`quotation_id`) ON DELETE CASCADE,
  ADD CONSTRAINT `pqi_product_fk` FOREIGN KEY (`product_id`) REFERENCES `product` (`product_id`),
  ADD CONSTRAINT `pqi_unit_fk` FOREIGN KEY (`unit_id`) REFERENCES `unit` (`unit_id`);

ALTER TABLE `inventory_cost_history`
  ADD CONSTRAINT `ich_product_fk` FOREIGN KEY (`product_id`) REFERENCES `product` (`product_id`),
  ADD CONSTRAINT `ich_branch_fk` FOREIGN KEY (`branch_id`) REFERENCES `branch` (`branch_id`);

ALTER TABLE `branch_inventory_snapshot`
  ADD CONSTRAINT `bis_branch_fk` FOREIGN KEY (`branch_id`) REFERENCES `branch` (`branch_id`),
  ADD CONSTRAINT `bis_product_fk` FOREIGN KEY (`product_id`) REFERENCES `product` (`product_id`);

-- =====================================================================
-- جداول لوحة مؤشرات الأداء الرئيسية (Dashboard KPI Tables)
-- =====================================================================

-- جدول مؤشرات الأداء الرئيسية (KPI Dashboard)
CREATE TABLE IF NOT EXISTS `cod_dashboard_kpi` (
  `kpi_id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL COMMENT 'اسم مؤشر الأداء',
  `category` varchar(50) NOT NULL DEFAULT 'general' COMMENT 'فئة المؤشر (sales, inventory, finance, customers, operations)',
  `value` decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'القيمة الحالية للمؤشر',
  `previous_value` decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'القيمة السابقة للمقارنة',
  `trend` decimal(8,4) NOT NULL DEFAULT '0.0000' COMMENT 'نسبة التغيير (موجب = زيادة، سالب = نقصان)',
  `target_value` decimal(15,4) DEFAULT NULL COMMENT 'القيمة المستهدفة',
  `date_range` enum('today','week','month','quarter','year','current') NOT NULL DEFAULT 'today' COMMENT 'نطاق البيانات',
  `unit` varchar(20) DEFAULT NULL COMMENT 'وحدة القياس (currency, percentage, count, etc)',
  `status` enum('active','inactive','calculating','error') NOT NULL DEFAULT 'active' COMMENT 'حالة المؤشر',
  `calculation_method` text COMMENT 'طريقة حساب المؤشر',
  `last_calculated` datetime DEFAULT NULL COMMENT 'آخر وقت حساب',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`kpi_id`),
  UNIQUE KEY `unique_kpi_range` (`name`, `date_range`),
  KEY `idx_category` (`category`),
  KEY `idx_status` (`status`),
  KEY `idx_last_calculated` (`last_calculated`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='جدول مؤشرات الأداء الرئيسية';

-- جدول تاريخ مؤشرات الأداء (KPI History)
CREATE TABLE IF NOT EXISTS `cod_dashboard_kpi_history` (
  `history_id` int(11) NOT NULL AUTO_INCREMENT,
  `kpi_id` int(11) NOT NULL,
  `value` decimal(15,4) NOT NULL,
  `trend` decimal(8,4) NOT NULL DEFAULT '0.0000',
  `calculation_date` datetime NOT NULL,
  `notes` text COMMENT 'ملاحظات إضافية',
  PRIMARY KEY (`history_id`),
  KEY `idx_kpi_id` (`kpi_id`),
  KEY `idx_calculation_date` (`calculation_date`),
  FOREIGN KEY (`kpi_id`) REFERENCES `cod_dashboard_kpi` (`kpi_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='تاريخ مؤشرات الأداء';

-- جدول إعدادات مؤشرات الأداء (KPI Settings)
CREATE TABLE IF NOT EXISTS `cod_dashboard_kpi_settings` (
  `setting_id` int(11) NOT NULL AUTO_INCREMENT,
  `kpi_name` varchar(100) NOT NULL,
  `auto_refresh` tinyint(1) NOT NULL DEFAULT '1' COMMENT 'التحديث التلقائي',
  `refresh_interval` int(11) NOT NULL DEFAULT '300' COMMENT 'فترة التحديث بالثواني',
  `cache_enabled` tinyint(1) NOT NULL DEFAULT '1' COMMENT 'تفعيل التخزين المؤقت',
  `cache_duration` int(11) NOT NULL DEFAULT '60' COMMENT 'مدة التخزين المؤقت بالدقائق',
  `display_order` int(11) NOT NULL DEFAULT '0' COMMENT 'ترتيب العرض',
  `is_visible` tinyint(1) NOT NULL DEFAULT '1' COMMENT 'مرئي في لوحة المعلومات',
  `alert_enabled` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'تفعيل التنبيهات',
  `alert_threshold` decimal(15,4) DEFAULT NULL COMMENT 'حد التنبيه',
  `alert_condition` enum('greater_than','less_than','equal','not_equal') DEFAULT NULL COMMENT 'شرط التنبيه',
  PRIMARY KEY (`setting_id`),
  UNIQUE KEY `unique_kpi_name` (`kpi_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='إعدادات مؤشرات الأداء';

-- إدراج البيانات الأساسية لمؤشرات الأداء
INSERT INTO `cod_dashboard_kpi_settings` (`kpi_name`, `display_order`, `alert_enabled`, `alert_threshold`, `alert_condition`) VALUES
('sales_today', 1, 0, NULL, NULL),
('orders_today', 2, 0, NULL, NULL),
('customers_online', 3, 1, 100, 'greater_than'),
('low_stock_items', 4, 1, 10, 'greater_than'),
('total_revenue_month', 5, 0, NULL, NULL),
('pending_orders', 6, 1, 20, 'greater_than'),
('avg_order_value', 7, 0, NULL, NULL),
('inventory_value', 8, 0, NULL, NULL),
('overdue_payments', 9, 1, 5, 'greater_than');

-- =====================================================================
-- جداول لوحة متابعة الأهداف (Dashboard Goals Tables)
-- =====================================================================

-- جدول الأهداف الرئيسية (Goals)
CREATE TABLE IF NOT EXISTS `cod_dashboard_goals` (
  `goal_id` int(11) NOT NULL AUTO_INCREMENT,
  `goal_title` varchar(255) NOT NULL COMMENT 'عنوان الهدف',
  `goal_description` text COMMENT 'وصف تفصيلي للهدف',
  `goal_type` enum('sales','revenue','profit','customers','orders','inventory','productivity','quality','cost_reduction','other') NOT NULL DEFAULT 'sales' COMMENT 'نوع الهدف',
  `target_value` decimal(15,4) NOT NULL COMMENT 'القيمة المستهدفة',
  `current_value` decimal(15,4) NOT NULL DEFAULT '0.0000' COMMENT 'القيمة الحالية المحققة',
  `unit` varchar(20) DEFAULT NULL COMMENT 'وحدة القياس (currency, percentage, count, etc)',
  `start_date` date NOT NULL COMMENT 'تاريخ بداية الهدف',
  `end_date` date NOT NULL COMMENT 'تاريخ انتهاء الهدف',
  `assigned_to` int(11) NOT NULL COMMENT 'المسؤول عن تحقيق الهدف',
  `department_id` int(11) DEFAULT NULL COMMENT 'القسم المسؤول',
  `priority` enum('low','medium','high','critical') NOT NULL DEFAULT 'medium' COMMENT 'أولوية الهدف',
  `status` enum('active','paused','completed','cancelled') NOT NULL DEFAULT 'active' COMMENT 'حالة الهدف',
  `completion_percentage` decimal(5,2) GENERATED ALWAYS AS (CASE WHEN target_value > 0 THEN (current_value / target_value) * 100 ELSE 0 END) STORED COMMENT 'نسبة الإنجاز المحسوبة',
  `created_by` int(11) NOT NULL COMMENT 'منشئ الهدف',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `completed_at` datetime DEFAULT NULL COMMENT 'تاريخ إكمال الهدف',
  PRIMARY KEY (`goal_id`),
  KEY `idx_assigned_to` (`assigned_to`),
  KEY `idx_department_id` (`department_id`),
  KEY `idx_status` (`status`),
  KEY `idx_goal_type` (`goal_type`),
  KEY `idx_priority` (`priority`),
  KEY `idx_end_date` (`end_date`),
  FOREIGN KEY (`assigned_to`) REFERENCES `cod_user` (`user_id`) ON DELETE RESTRICT,
  FOREIGN KEY (`department_id`) REFERENCES `cod_user_group` (`user_group_id`) ON DELETE SET NULL,
  FOREIGN KEY (`created_by`) REFERENCES `cod_user` (`user_id`) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='جدول الأهداف الرئيسية';

-- جدول تقدم الأهداف (Goal Progress)
CREATE TABLE IF NOT EXISTS `cod_dashboard_goal_progress` (
  `progress_id` int(11) NOT NULL AUTO_INCREMENT,
  `goal_id` int(11) NOT NULL,
  `progress_value` decimal(15,4) NOT NULL COMMENT 'قيمة التقدم المسجلة',
  `progress_percentage` decimal(5,2) GENERATED ALWAYS AS (
    (SELECT CASE WHEN target_value > 0 THEN (progress_value / target_value) * 100 ELSE 0 END
     FROM cod_dashboard_goals WHERE goal_id = cod_dashboard_goal_progress.goal_id)
  ) STORED COMMENT 'نسبة التقدم المحسوبة',
  `notes` text COMMENT 'ملاحظات حول التقدم',
  `recorded_by` int(11) NOT NULL COMMENT 'من سجل التقدم',
  `recorded_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`progress_id`),
  KEY `idx_goal_id` (`goal_id`),
  KEY `idx_recorded_by` (`recorded_by`),
  KEY `idx_recorded_at` (`recorded_at`),
  FOREIGN KEY (`goal_id`) REFERENCES `cod_dashboard_goals` (`goal_id`) ON DELETE CASCADE,
  FOREIGN KEY (`recorded_by`) REFERENCES `cod_user` (`user_id`) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='جدول تقدم الأهداف';

-- جدول مهام الأهداف (Goal Tasks)
CREATE TABLE IF NOT EXISTS `cod_dashboard_goal_tasks` (
  `task_id` int(11) NOT NULL AUTO_INCREMENT,
  `goal_id` int(11) NOT NULL,
  `task_title` varchar(255) NOT NULL COMMENT 'عنوان المهمة',
  `task_description` text COMMENT 'وصف المهمة',
  `assigned_to` int(11) NOT NULL COMMENT 'المسؤول عن المهمة',
  `due_date` date DEFAULT NULL COMMENT 'تاريخ استحقاق المهمة',
  `priority` enum('low','medium','high','critical') NOT NULL DEFAULT 'medium',
  `status` enum('pending','in_progress','completed','cancelled') NOT NULL DEFAULT 'pending',
  `completion_percentage` int(3) NOT NULL DEFAULT '0' COMMENT 'نسبة إنجاز المهمة',
  `created_by` int(11) NOT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `completed_at` datetime DEFAULT NULL,
  PRIMARY KEY (`task_id`),
  KEY `idx_goal_id` (`goal_id`),
  KEY `idx_assigned_to` (`assigned_to`),
  KEY `idx_status` (`status`),
  KEY `idx_due_date` (`due_date`),
  FOREIGN KEY (`goal_id`) REFERENCES `cod_dashboard_goals` (`goal_id`) ON DELETE CASCADE,
  FOREIGN KEY (`assigned_to`) REFERENCES `cod_user` (`user_id`) ON DELETE RESTRICT,
  FOREIGN KEY (`created_by`) REFERENCES `cod_user` (`user_id`) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='جدول مهام الأهداف';

-- جدول تعليقات الأهداف (Goal Comments)
CREATE TABLE IF NOT EXISTS `cod_dashboard_goal_comments` (
  `comment_id` int(11) NOT NULL AUTO_INCREMENT,
  `goal_id` int(11) NOT NULL,
  `comment_text` text NOT NULL,
  `comment_type` enum('general','progress_update','issue','milestone') NOT NULL DEFAULT 'general',
  `created_by` int(11) NOT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`comment_id`),
  KEY `idx_goal_id` (`goal_id`),
  KEY `idx_created_by` (`created_by`),
  KEY `idx_created_at` (`created_at`),
  FOREIGN KEY (`goal_id`) REFERENCES `cod_dashboard_goals` (`goal_id`) ON DELETE CASCADE,
  FOREIGN KEY (`created_by`) REFERENCES `cod_user` (`user_id`) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='جدول تعليقات الأهداف';

-- =====================================================================
-- جداول لوحة التنبيهات والإنذارات (Dashboard Alerts Tables)
-- =====================================================================

-- جدول التنبيهات الرئيسية (Alerts)
CREATE TABLE IF NOT EXISTS `cod_dashboard_alerts` (
  `alert_id` int(11) NOT NULL AUTO_INCREMENT,
  `alert_type` enum('low_stock','overdue_payment','pending_order','goal_deadline','system_performance','custom','info','warning','error','success') NOT NULL DEFAULT 'info' COMMENT 'نوع التنبيه',
  `title` varchar(255) NOT NULL COMMENT 'عنوان التنبيه',
  `message` text NOT NULL COMMENT 'رسالة التنبيه',
  `priority` enum('low','medium','high','critical') NOT NULL DEFAULT 'medium' COMMENT 'أولوية التنبيه',
  `target_type` enum('all','specific','department','role') NOT NULL DEFAULT 'all' COMMENT 'نوع الاستهداف',
  `target_data` text COMMENT 'بيانات الاستهداف (JSON)',
  `action_url` varchar(500) DEFAULT NULL COMMENT 'رابط الإجراء المطلوب',
  `action_text` varchar(100) DEFAULT NULL COMMENT 'نص الإجراء',
  `is_system_generated` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'تنبيه مولد من النظام',
  `expires_at` datetime DEFAULT NULL COMMENT 'تاريخ انتهاء صلاحية التنبيه',
  `created_by` int(11) NOT NULL COMMENT 'منشئ التنبيه',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`alert_id`),
  KEY `idx_alert_type` (`alert_type`),
  KEY `idx_priority` (`priority`),
  KEY `idx_target_type` (`target_type`),
  KEY `idx_created_by` (`created_by`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_expires_at` (`expires_at`),
  FOREIGN KEY (`created_by`) REFERENCES `cod_user` (`user_id`) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='جدول التنبيهات الرئيسية';

-- جدول مستقبلي التنبيهات (Alert Recipients)
CREATE TABLE IF NOT EXISTS `cod_dashboard_alert_recipients` (
  `recipient_id` int(11) NOT NULL AUTO_INCREMENT,
  `alert_id` int(11) NOT NULL,
  `user_id` int(11) NOT NULL,
  `is_read` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل تم قراءة التنبيه',
  `read_at` datetime DEFAULT NULL COMMENT 'تاريخ القراءة',
  `is_dismissed` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل تم إخفاء التنبيه',
  `dismissed_at` datetime DEFAULT NULL COMMENT 'تاريخ الإخفاء',
  `notification_sent` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'هل تم إرسال إشعار',
  `notification_sent_at` datetime DEFAULT NULL COMMENT 'تاريخ إرسال الإشعار',
  PRIMARY KEY (`recipient_id`),
  UNIQUE KEY `unique_alert_user` (`alert_id`, `user_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_is_read` (`is_read`),
  KEY `idx_is_dismissed` (`is_dismissed`),
  KEY `idx_read_at` (`read_at`),
  FOREIGN KEY (`alert_id`) REFERENCES `cod_dashboard_alerts` (`alert_id`) ON DELETE CASCADE,
  FOREIGN KEY (`user_id`) REFERENCES `cod_user` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='جدول مستقبلي التنبيهات';

-- جدول إعدادات التنبيهات (Alert Settings)
CREATE TABLE IF NOT EXISTS `cod_dashboard_alert_settings` (
  `setting_id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `alert_type` varchar(50) NOT NULL COMMENT 'نوع التنبيه',
  `is_enabled` tinyint(1) NOT NULL DEFAULT '1' COMMENT 'تفعيل التنبيه',
  `email_notification` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'إشعار بريد إلكتروني',
  `sms_notification` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'إشعار رسالة نصية',
  `desktop_notification` tinyint(1) NOT NULL DEFAULT '1' COMMENT 'إشعار سطح المكتب',
  `sound_notification` tinyint(1) NOT NULL DEFAULT '1' COMMENT 'إشعار صوتي',
  `priority_filter` enum('all','medium','high','critical') NOT NULL DEFAULT 'all' COMMENT 'تصفية الأولوية',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`setting_id`),
  UNIQUE KEY `unique_user_alert_type` (`user_id`, `alert_type`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_alert_type` (`alert_type`),
  FOREIGN KEY (`user_id`) REFERENCES `cod_user` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='جدول إعدادات التنبيهات';

-- جدول سجل التنبيهات (Alert Log)
CREATE TABLE IF NOT EXISTS `cod_dashboard_alert_log` (
  `log_id` int(11) NOT NULL AUTO_INCREMENT,
  `alert_id` int(11) NOT NULL,
  `user_id` int(11) NOT NULL,
  `action` enum('created','read','dismissed','clicked','expired') NOT NULL COMMENT 'نوع الإجراء',
  `ip_address` varchar(45) DEFAULT NULL COMMENT 'عنوان IP',
  `user_agent` text COMMENT 'معلومات المتصفح',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`log_id`),
  KEY `idx_alert_id` (`alert_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_action` (`action`),
  KEY `idx_created_at` (`created_at`),
  FOREIGN KEY (`alert_id`) REFERENCES `cod_dashboard_alerts` (`alert_id`) ON DELETE CASCADE,
  FOREIGN KEY (`user_id`) REFERENCES `cod_user` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='جدول سجل التنبيهات';


-- Dashboard Settings Table for AYM ERP
CREATE TABLE IF NOT EXISTS `oc_dashboard_settings` (
  `setting_id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `refresh_interval` int(11) DEFAULT 300 COMMENT 'Refresh interval in seconds',
  `default_tab` varchar(50) DEFAULT 'overview' COMMENT 'Default dashboard tab',
  `enable_animations` tinyint(1) DEFAULT 1 COMMENT 'Enable dashboard animations',
  `enable_cache` tinyint(1) DEFAULT 1 COMMENT 'Enable data caching',
  `date_modified` datetime NOT NULL,
  PRIMARY KEY (`setting_id`),
  UNIQUE KEY `user_id` (`user_id`),
  KEY `idx_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Dashboard user settings';